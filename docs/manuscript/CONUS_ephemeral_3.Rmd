---
title: "Ephemeral stream contributions to United States drainage networks"
author:
  - Craig B Brinkerhoff:
      email: cbrinkerhoff@umass.edu
      institute: UMass
      correspondence: true
  - Colin J Gleason:
      institute: UMass
  - Mathew J Kotchen:
      institute: Yale1
  - Doug Kysar:
      institute: Yale2
  - Peter A Raymond:
      institute: Yale1
institute:
  - UMass: Department of Civil & Environmental Engineering, University of Massachusetts; Amherst, MA.
  - Yale1: School of the Environment, Yale University; New Haven, CT.
  - Yale2: Yale Law School, Yale University, New Haven; CT.
bibliography: References.bib
csl: science_csl.csl
output:
  #html_document
  word_document:
      fig_caption: yes
      pandoc_args:
        - '--lua-filter=scholarly-metadata.lua'
        - '--lua-filter=author-info-blocks.lua'
      reference_docx: word-styles-reference.docx
---

```{r, echo=FALSE, results='hide'}
library(targets)
library(captioner) #used to auto generate figure and Table numbers (so I stop going insane!)
setwd('/nas/cee-water/cjgleason/craig/CONUS_ephemeral') #R thinks it's in /manuscript...
source('src/utils.R') #getMode function

##############SET UP AUTOMATIC TABLE NUMBERING AND CAPTIONS--------------------------------
table_nums <- captioner::captioner(prefix = "Table")
table_nums(name = "data_summary",caption = "Summary of models and geospatial data used to drive our model and generate our results. Point-based data used to validate is described in sections 1.4 and 4.1.")

table_nums(name="field_data", caption="Field assessments of stream ephemerality performed in New England (Summer 2022). We followed the ephemeral/intermittent/perennial protocol for the State of North Carolina Department of Water Quality [@dorneyChapterNorthCarolina2018]. Scores < 19 are deemed 'ephemeral'.")

table_nums(name="classVal", caption="Classification metrics used to assess the ephemeral mapping model. TP is the true positive rate, TN is the true negative rate, FP is the false positive rate, and FN is the false negative rate.")

table_nums(name="Nflw_data", caption="In situ measurements of mean annual number of flowing days for ephemeral streams, compared against the same value calculated via our model.")

table_nums(name="runoff_tests", caption="Runoff scenarios used in the $N_{flw}$ sensitivity analysis. See section 5.2 for more specifics.")

##############SET UP AUTOMATIC SUPP FIGURE NUMBERING AND CAPTIONS--------------------------------
fig_nums_supp <- captioner::captioner(prefix = "Figure")
fig_nums_supp(name = "mainVal",caption = "Main validation/verification plots for our model: (A) Regional classification accuracy of the ephemeral stream map against completely independent field assessments of stream ephemerality. (B) Validation of mean annual discharge model at approximately 4,000 streams across CONUS. (C) Verification that the percent of discharge exported from drainage networks that is ephemerally-sourced is theoretically anticipated by basins' upstream ephemeral network extent. Only basins completely within the United States are used for this verification- see Text S1 for more details.")

fig_nums_supp(name = "val2",caption = paste0("Regional validation of the ephemeral stream classification model against completely independent field assessments of stream ephemerality: (A) regional model true skill score (TSS) and (B) number of field-observations per region. See Table S", table_nums("classVal", display="n"), " for metric definitions. The greyed-out region ('Souris-Red-Rainy') has no ephemeral validation data. See Text S1 for more details."))

fig_nums_supp(name = "val3",caption = "Regional validations of the ephemeral stream classification model against completely independent field assessments of stream ephemerality: (A) regional model classification sensitivity and (B) specificity. The greyed-out region ('Souris-Red-Rainy') has no ephemeral validation data. See Teaxt S1 for more details.")

fig_nums_supp(name = "val4",caption = paste0("Boxplots of regional ephemeral classification performance, by accuracy metric (section 3.2). Red dots correspond to the mean values. See Table S", table_nums("classVal", display="n"), " for metric definitions."))

fig_nums_supp(name = "walnutGulch",caption = "Field-scale model performance in the ephemeral Walnut Gulch experimental watershed. (A) Map of the model classification, indicating that we successfully identify the entire watershed as ephemeral (the 'non-ephemeral' reach is identified as a canal within our hydrography). (B) Validation of the mean annual discharge model at in-situ flumes within the watershed, which are also mapped in (A). For quality control, these flume data correspond to all sites whose reported drainage areas are within 20% of the drainage areas reported in our hydrography.")

fig_nums_supp(name = "classificationSens",caption = "Sensitivity of ephemeral classification to the snapping threshold used to join field assessments of ephemerality to the drainage network (sections 1.4 and 3.3). Red points reflect the mean values.")

fig_nums_supp(name = "scalingFig",caption = paste0("Scaling model for CONUS ephemeral stream network. Orange points represent ephemeral streams explicitly associated with hydrography reaches while the green point represents ephemeral stream implicitly represented in our headwater hydrography (see section 3.3 and Fig. S", fig_nums_supp("snappingSens", display="n"), ")."))

fig_nums_supp(name = "snappingSens",caption = paste0("Sensitivity of our stream order scaling (Fig. S", fig_nums_supp("scalingFig", display="n"), ") to the snapping threshold used to join field assessments of ephemerality to the drainage network (sections 1.4 and 3.3). Green line is the number of hypotetical stream orders (analagous to the green point in (Fig. S", fig_nums_supp("scalingFig", display="n"), "). Purple line is the mean absolute error (MAE) of the Horton law of stream numbers (equation S4). MAE should be smallest when the data best match Horton's laws, indicating that we are not missassinging field data to the wrong rivers."))

fig_nums_supp(name = "runoffCalib",caption = "Determining an operational streamflow definition ($i_{min}$) using the available $N_{flw}$ data (section 4.2).")

fig_nums_supp(name="nFlwSens", caption=paste0("Sensitivity test for $N_{flw}$ (section 4.2). The white boxplot is the distribution of the actual model results. Table S", table_nums("classVal", display="n"), " details the runoff scenarios used to drive this senstivity test."))

fig_nums_supp(name="hydrographies", caption="Sample of 16/205 drainage network hydrographies classified using our model. Sub-plot titles refer to the relative and absolute values of discharge exported from drainage networks that is ephemerally-sourced (equation S1). Note that foreign streams are mapped as 'not ephemeral' in these plots for visualization's sake (e.g. lower Colorado in sub-panel d).")

fig_nums_supp(name = "drainageAreaMap",caption = "Contiguous United States map of the percent of upstream drainage area that contributes to ephemeral streams (equation S2).")

##############SET UP AUTOMATIC FIGURE NUMBERING AND CAPTIONS--------------------------------
fig_nums <- captioner::captioner(prefix = "Figure")
fig_nums(name = "figQ",caption = paste0("Ephemeral stream water contributions to CONUS drainage networks. (A) Contiguous United States map of the percent of discharge exported from drainage networks that is ephemerally-sourced (equation S1). (B-E) Drainage network maps and ephemeral export percents for four representative basins: (B) endorheic desert basin, (C) semi-arid western basin, (D) temperate, mountainous basin, and (E) a temperate, flat basin. Reach size corresponds to logarithmic bins of streamflow and is relative to map scale. Additional basins are mapped in Fig. S", fig_nums_supp("hydrographies", display="n"), ". For each basin we also provide the mean annual volume of exported water that is ephemerally-sourced."))

fig_nums(name="figQ_SO", caption="Ephemeral stream water contributions internal to drainage networks. (A) Percent of CONUS stream order extent that is ephemeral. (B) Average percent of upstream drainage area that is ephemeral by stream order, where boxplots are composed of CONUS basins and lines show the median trend. (C) Same, but for the average percent of discharge that is ephemerally-sourced. Note that only one network has 11 stream orders (the lower Columbia River).")

fig_nums(name="figNflw", caption="Frequency of ephemeral streamflow. (A) Contiguous United States map of the average number of days that ephemeral streams flow per year, with points indicating approximate locations of field verification data. (B) Verification of model results with field data. (C) Histogram of model resuls from (A).")

##############LOAD IN RESULTS--------------------------------
#model results
tar_load(combined_results)
combined_results <- dplyr::filter(combined_results, !is.na(num_flowing_dys)) #remove great lakes
tar_load(combined_results_by_order)
tar_load(USGS_data)
tar_load(validationResults)

#validation results
tar_load(val_shapefile_fin)
val_shapefile_fin <- val_shapefile_fin$shapefile
tar_load(flowingDaysValidation)
tar_load(combined_percEph_firstOrder)

#SOME REGIONAL CATEGORIES FOR FURTHER STATS--------------------------------
combined_results$huc4 <- substr(combined_results$method, 9,13)
combined_results_by_order$huc4 <- substr(combined_results_by_order$method, 18,22)
east <- c('0101', '0102', '0103', '0104', '0105', '0106', '0107', '0108', '0109', '0110',
          '0202', '0203', '0206', '0207', '0208', '0204', '0205',
          '0301', '0302', '0303', '0304', '0305', '0306', '0307', '0308', '0309', '0310', '0311', '0312', '0313', '0314', '0315', '0316', '0317', '0318',
          '0401', '0402', '0403', '0404', '0405', '0406', '0407', '0408', '0409', '0410', '0411', '0412', '0413', '0414', '0420', '0427', '0429', '0430',
          '0501', '0502', '0503', '0504', '0505', '0506', '0507', '0508', '0509', '0510', '0511', '0512', '0513', '0514',
          '0601', '0602', '0603', '0604',
          '0701', '0703', '0704', '0705', '0707', '0709', '0712', '0713', '0714',
          '0801', '0803', '0806', '0807', '0809',
          '0901', '0902', '0903', '0904')
west <- combined_results[!(combined_results$huc4 %in% c(east)),]$huc4

southwest <- c('13', '14', '15')

badAccuracy <- c('08', '05', '06')
goodAccuracy <- c('01', '02', '18', '17', '15', '14', '13')

############SUMMARISE RESULTS-----------------------------
#stats for Q
relativeExport <- summary(combined_results$percQEph_exported)
relativeExport_da <-  summary(combined_results$percAreaEph_exported)
relativeExport_order1 <- summary(combined_results_by_order[combined_results_by_order$StreamOrde==1,]$percQEph_reach_mean)

relativeExportEast_order1 <- summary(combined_results_by_order[combined_results_by_order$StreamOrde==1 & combined_results_by_order$huc4 %in% east,]$percQEph_reach_mean)
relativeExportWest_order1 <- summary(combined_results_by_order[combined_results_by_order$StreamOrde==1 & combined_results_by_order$huc4 %in% west,]$percQEph_reach_mean)

overFifty <- sum(combined_results$percQEph_exported > 0.50)

mississippi <- tar_read(results_0809)
columbia <- tar_read(results_1708)

#calculate flow frequency numbers
meanFlowFreq <- round(mean(combined_results$num_flowing_dys),0)
relativeFlowFreq <- round((mean(combined_results$num_flowing_dys)/365)*100,0) #%
Nflw_se <- round(summary(lm(num_flowing_dys~n_flw_d, data=flowingDaysValidation))$sigma,0) #model standard error, i.e. uncertainty

#validation numbers and results
nreaches <- sum(combined_results$n_total)
nDischargeValidation <- nrow(USGS_data)
nMapValidation <- nrow(validationResults$validation_fin)
perc_headwater_eph <- round((sum(combined_percEph_firstOrder$num_eph_headwater, na.rm=T) / sum(combined_percEph_firstOrder$num_headwater, na.rm=T))*100,0)
```

## One-Sentence Summary
Ephemeral streams contribute a significant portion of freshwater to drainage networks and implicate downstream water quality.

## Abstract
Ephemeral streams flow only in direct response to precipitation and are ubiquitous features of the landscape. Their influence on hydrology is underdeveloped and therefore little is known about how ephemeral streams influence downstream flow rates and water chemistry, potentially creating issues for water quality policy [@departmentofthearmycorpsofengineersNavigableWatersProtection2020]. Here, we model ephemeral stream water contributions to the contiguous United States network of `r formatC(nreaches, format="d", big.mark=",")` rivers, lakes, reservoirs, canals, and ditches, finding that they contribute on average `r round(relativeExport[4]*100,0)`% of the discharge exported from drainage networks while flowing on average `r meanFlowFreq` $\pm$ `r Nflw_se` days a year. This significant contribution is facilitated by small headwater streams, where on average `r round(relativeExport_order1[4]*100,0)`% of headwater streamflow is ephemeral. The ephemeral terrestrial-aquatic connection is therefore a substantial pathway through which pollution may enter the downstream perennial drainage network and degrade water quality.

## Main Text
Streams transport nutrients, sediments, pollutants, and other solutes from the land surface to rivers, lakes, reservoirs, and ultimately the oceans [@raymondHydrologicalBiogeochemicalControls2016; @heAssessmentGlobalNitrogen2011; @schmidtExportPlasticDebris2017; @liuRiversLargestSource2021], influencing all downstream water quality [@alexanderFeaturedCollectionIntroduction2018; @harveyHowHydrologicConnectivity2019a; @keiserConsequencesCleanWater2019]. The most upland streams (hereafter headwaters) are often 'ephemeral' streams, which flow only in direct response to precipitation and are disconnected from groundwater year-round, unlike larger downstream rivers.  Non-perennial streams (which include ephemeral and intermittently dry rivers) account for over half of the global river network [@messagerGlobalPrevalenceNonperennial2021]. While much recent work has developed classification models to map non-perennial stream extent [@messagerGlobalPrevalenceNonperennial2021; @jaegerProbabilityStreamflowPermanence2019; @durighettoProbabilisticDescriptionStreamflow2022; @russellSpatiallyExplicitModel2015; @fesenmyerLargePortionUSA2021; @cavalloExploitingSentinel2Dataset2022], nearly no work focuses specifically on ephemeral streams [@fesenmyerLargePortionUSA2021] and all work stopped short of assessing the hydrological contributions of non-perennial streams to the overall drainage network at broad spatial scales. While it is regionally established that headwater streams contribute meaningfully to downstream water quantity and quality [@alexanderRoleHeadwaterStreams2007; @fritzPhysicalChemicalConnectivity2018], we presently have no explicit assessment of ephemeral contributions to global hydrology, nor their potential influence on downstream water quality.

In this context, here we use a simple geomorphic model to identify ephemeral streams by comparing long-term water table depths with streamline presence in `r formatC(nreaches, format="d", big.mark=",")` discrete streams, rivers, lakes, reservoirs, canals, and ditches across the contiguous United States (CONUS) [@MaterialsMethodsAre]. We use published groundwater, discharge, runoff, and precipitation models [@fanHydrologicRegulationPlant2017; @u.s.geologicalsurveyNationalHydrographyDataset2022; @brakebillDigitalHydrologicNetworks2011; @xieGaugeBasedAnalysisDaily2007] and a network routing framework [@brinkerhoffLakeMorphometryRiver2021] to quantify the percent of each river's mean annual discharge that was contributed by upstream CONUS ephemeral streams. We also quantify how frequently ephemeral streams flow [@MaterialsMethodsAre]. We define and discuss the metrics that make up our assessment (equations S1-S3), validate individual model components at up to `r formatC(nMapValidation, format="d", big.mark=",")` streams and rivers across CONUS (Text S1, Figs. S`r fig_nums_supp("mainVal", display="n")`-S`r fig_nums_supp("walnutGulch", display="n")`), and test parameter sensitivity when necessary (Figs. S`r fig_nums_supp("classificationSens", display="n")`-S`r fig_nums_supp("nFlwSens", display="n")`) [@MaterialsMethodsAre].

### The ephemeral pulse of drainage networks
![Fig. `r fig_nums("figQ", display="n")`: `r substr(fig_nums("figQ", display="full"), 12, nchar(fig_nums("figQ", display="full")))`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/paper_figures/fig1.jpg)

On average, `r round(relativeExport[4]*100,0)`% of annual drainage network discharge (by water volume) is sourced from upstream ephemeral streams. This varies significantly across basins (from `r round(relativeExport[1]*100,0)`% to `r round(relativeExport[6]*100,0)`%), with generally greater ephemeral influence in western basins. Regional hotspots occur where ephemeral streams most dominate the landscape, namely the desert and endorheic basins of the southwest and Great Basin (Fig. `r fig_nums("figQ", display="n")`a). However, ephemeral contributions to discharge are consistently high across across CONUS: `r round((overFifty/nrow(combined_results))*100,0)`% of networks export water that is at least 50% ephemeral and the largest rivers in the United States export large volumes of ephemeral water: the Mississippi River export is `r round(mississippi$percQEph_export*100,0)`% originating from ephemeral reaches and the Colombia river export is `r round(columbia$percQEph_export*100,0)`% ephemeral. Given that discharge generally accumulates in drainage networks that follow predictable scaling patterns, our results (Fig. `r fig_nums("figQ", display="n")`a) are theoretically anticipated by the average upstream ephemeral network extent (Fig. S`r fig_nums_supp("mainVal", display="n")`c, Text S1). Our results also support previous modeling in northeastern CONUS, where 70% of exported streamflow is sourced from headwater streams [@alexanderRoleHeadwaterStreams2007]. We also express the ephemeral contribution to discharge has a function of drainage area (Fig. S`r fig_nums_supp("drainageAreaMap", display="n")`, equation S2), where on average `r round(relativeExport_da[4]*100,0)`% of a basin's upstream drainage area is ephemeral and there is a clear east/west divide in land surface contributions to drainage networks.

Ephemeral stream hydrography, largely governed by lateral groundwater fluxes and watershed geomorphology, is a result of both topography and climate [@gleesonClassifyingWaterTable2011; @condonEvaluatingRelationshipTopography2015]. In the East, ephemeral streams are most numerous in upland settings, where they sit upland of the groundwater point of emergence (e.g. Fig. `r fig_nums("figQ", display="n")`d versus `r fig_nums("figQ", display="n")`e, S`r fig_nums_supp("hydrographies", display="n")`). In much of the West, where the water table is kilometers below the surface, ephemeral streams can dominate the landscape (Figs. `r fig_nums("figQ", display="n")`b, `r fig_nums("figQ", display="n")`c, S`r fig_nums_supp("hydrographies", display="n")`). The Great Lakes/Midwest region and Florida have the smallest ephemeral influence due to low-order networks with persistently shallow water tables [@fanHydrologicRegulationPlant2017]. The Midwest region is also strongly influenced by artificial irrigation ditches, which are not natural ephemeral streams but contribute significantly to discharge. Our analysis is limited to CONUS ephemeral streams and ignores Mexican/Canadian ephemeral streams, as well as all ephemeral canals, ditches, and ponds. We also do not account for human groundwater pumping [@MaterialsMethodsAre] and thus are likely under-estimating ephemeral streams where pumping is significant. Ephemeral streams will only become more frequent as groundwater pumping intensifies and water tables lower further [@goodrichSouthwesternIntermittentEphemeral2018; @scanlonGroundwaterDepletionSustainability2012]. Overall, our analysis represents a conservative estimate of ephemeral hydrography.

![Fig. `r fig_nums("figQ_SO", display="n")`: `r substr(fig_nums("figQ_SO", display="full"), 12, nchar(fig_nums("figQ_SO", display="full")))`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/paper_figures/fig2.jpg)

Internal to drainage networks, stream size exerts a fundamental control on the ephemeral contribution to river hydrology (Fig. `r fig_nums("figQ_SO", display="n")`). On average, first-order discharge is `r round(relativeExport_order1[4]*100,0)`% ephemerally sourced across all CONUS basins (Fig. `r fig_nums("figQ_SO", display="n")`c). This result varies predictably east and west of the Mississippi River (`r round(relativeExportEast_order1[4]*100,0)`% versus `r round(relativeExportWest_order1[4]*100,0)`%, respectively). Hereafter, we refer to these regions as 'east' and 'west'. Given the first-order control of topography on eastern ephemeral stream presence (Fig. `r fig_nums("figQ", display="n")`), the eastern ephemeral contribution decreases more rapidly to approximately 60% in large rivers, while decreasing more slowly in western basins (Fig. `r fig_nums("figQ_SO", display="n")`c). The ephemeral drainage area percent decreases similarly with stream size (Fig `r fig_nums("figQ_SO", display="n")`b). Overall, these results are driven by the sheer extent of ephemeral steams in orders 1-3 in the east and 1-5 in the west (Fig `r fig_nums("figQ_SO", display="n")`a).

![Fig. `r fig_nums("figNflw", display="n")`: `r substr(fig_nums("figNflw", display="full"), 12, nchar(fig_nums("figNflw", display="full")))`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/paper_figures/fig3.jpg)

The significance of the ephemeral contribution to discharge (Figs. `r fig_nums("figQ", display="n")`-`r fig_nums("figQ_SO", display="n")`) is underpinned by how often they flow (Fig. `r fig_nums("figNflw", display="n")`). Ephemeral streams flow on average `r meanFlowFreq` $\pm$ `r Nflw_se` days per year across all basins, but with most basins flowing only 0-10 days in an average year (Fig. `r fig_nums("figNflw", display="n")`c). Ephemeral flow frequency manifests as a balance of evapotranspiration, the size and frequency of precipitation events, and antecedent moisture conditions influencing runoff generation. For example, in western basins ephemeral streams only flow `r  round(mean(combined_results[combined_results$huc4 %in% west, ]$num_flowing_dys),0)` days a year on average, while they flow `r  round(mean(combined_results[combined_results$huc4 %in% east, ]$num_flowing_dys),0)` days on average in eastern Basins. In the arid southwestern United States, this drops to an average of `r round(mean(combined_results[substr(combined_results$huc4,1,2) %in% southwest, ]$num_flowing_dys),0)` days a year. Our simple model uses only a precipitation timeseries, runoff data, and an operational definition for streamflow [@MaterialsMethodsAre]. It reasonably matches in situ sensor data of catchment-averaged ephemeral flow frequency (Fig. `r fig_nums("figNflw", display="n")`b). With that said, we stress that extremely little data and knowledge exists on ephemeral flow frequency at the drainage network scale (Fig. `r fig_nums("figNflw", display="n")`b). Future work should explore ephemeral runoff generation across sensor networks to refine our modeling.

### Downstream threats to water quality
Given such infrequent flow, our results (Fig. `r fig_nums("figNflw", display="n")`) suggest that ephemeral streams likely dominate drainage network responses to storm events, shunting pollutants and other solutes downstream at even greater rates than suggested here under mean annual conditions [@raymondHydrologicalBiogeochemicalControls2016]. The exact impacts of ephemeral discharge on constituent loads and concentrations will be context dependent. The delivery of most elements, nutrients and pollutants, however, scale with discharge [@raymondHydrologicalBiogeochemicalControls2016; @catalanPulseShuntStorage2022] and are dominated by inputs from headwater streams (of which `r perc_headwater_eph`% of CONUS headwater streams are ephemeral according to our model). Thus, we would expect the importance and impacts of ephemerally-sourced water on stream and river chemistry to be high in downstream regions that have accumulated large ephemeral water contributions.

Ephemeral streams' regulated status under the United States Clean Water Act (CWA) has been a long-debated and often contentious topic [@keiserEvolutionWatersUnited2022]. Ephemeral streams have received considerable attention from environmental groups, farm lobbying groups, and politicians since the CWA was enacted in 1972 [@sullivanDistortingSciencePutting2020; @alexanderFeaturedCollectionIntroduction2018; @departmentofthearmycorpsofengineersNavigableWatersProtection2020].

**Room here for a paragraph to flesh out implications, regulations, policy, etc. from Doug and Matt.**

### Summary
A rapidly growing body of literature shows that temporary streams are the rule and not the exception [@messagerGlobalPrevalenceNonperennial2021; @fesenmyerLargePortionUSA2021] and that they exert significant controls on downstream water quality [@alexanderRoleHeadwaterStreams2007]. We show here that ephemeral streams can be identified using a simple geomorphic model, validated at `r nMapValidation` discrete streams and rivers across CONUS and using only free and open-source data, models, and geo-processing tools. We also demonstrate the implications of the accumulative nature of streamflow, and suggest that water quality management might require upstream and cross-basin collaboration between stakeholders, managers, and conservationists. 

## References
references must be moved here manually for Science submission

## Acknowledgements

### General
We thank Dr. Ying Fan Reinfelder, the USGS, and the EPA for making their data and/or models freely available. We also thank Brian Saccardi for helping manually verify portions of the basin routing scheme. All modeling was performed on the Unity cluster at the Massachusetts Green High Performance Computing Center (MGHPCC).

### Funding
Am I missing anything?
Craig Brinkerhoff, Peter Raymond, and Colin Gleason were supported by *WROL*. Craig Brinkerhoff was also supported by *FINESST*.

### Author Contributions

-   Conceptualization: PAR, CBB, MJK, DK

-   Methodology: CBB, PAR, CJG

-   Investigation: CBB, PAR, CJG, MJK, DK

-   Visualization: CBB

-   Supervision: PAR

-   Writing- original draft: CBB

-   Writing- review & editing: CBB, CJG, PAR, MJK, DK

### Competing interests
Authors declare that they have no competing interests.

### Data and materials availability
blah blah blah.

## Supplementary Materials

-   Materials and Methods

-   Text S1

-   Figs. S1 to S12

-   Tables S1 to S5

-   References 30-61

\newpage

<center>

![](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/docs/manuscript/science_logo.jpg)

# Supplementary Materials for

Ephemeral stream contributions to United States drainage networks

C.B. Brinkerhoff, C.J. Gleason, M.J. Kotchen, D. Kysar, P.A. Raymond

Correspondence to cbrinkerhoff@umass.edu

</center>

## This PDF file includes:

-   Materials and Methods

-   Text S1

-   Figs. S1 to S12

-   Tables S1 to S5

## Materials and Methods

All modeling and analysis was performed on the Unity Cluster at the Massachusetts Green High Performance Computing Center (MGHPCC) using publicly available datasets, models, and entirely free and open-source geoprocessing tools in the R programming language. All data and models used in this analysis are described in Table S`r table_nums('data_summary', display='n')`.

### 1 Drainage network framework

#### 1.1 Overview

CONUS drainage network hydrography is defined by the United States Geological Survey (USGS) National Hydrography Dataset High-Resolution (NHD-HR) built at 1:24,000 map scale [@u.s.geologicalsurveyNationalHydrographyDataset2022], which is still in development by the USGS. We use the data publicly available as of Spring 2022. This is the highest resolution hydrography data available and is often treated as a gold-standard to benchmark hydrography models against. The NHD-HR is discretized into 'reaches', which correspond to mass-conserved segments of rivers, streams, ditches, canals, lakes, and reservoirs. The NHD-HR uses artificial flowpaths to maintain network topology through lakes and reservoirs, and here we use a previous framework to explicitly incorporate lake/reservoir bathymetry into our model that accounts for complex lakes/reservoirs with multiple river inputs [@brinkerhoffLakeMorphometryRiver2021]. The NHD-HR also uses nested drainage basins across 12 scales. We run our model at the 4th level and our mapping validation at the 2nd level. This was done based on data resolution, data availability across the United States, and ease of interpretation.

As will all human-built products, NHD-HR data quality varies across CONUS. We identified significantly higher drainage densities in the NHD-HR for the state of Indiana (often 1-2x the stream orders as other portions of a given basin in adjacent U.S. states). For these basins, we manually removed the lowest 1 or two stream orders within the Indiana portions of these basins, until the whole-basin drainage density was visually consistent. We also removed all divergent reaches, i.e. minor flowpaths that diverge from the main downstream path of flow. We did not remove the rest of the flowpath downstream of a divergent reach if there was another, non-divergent source that joined and made the path no longer divergent. Divergent channels are generally alternative flowpaths for the same rivers, and so we remove them to avoid double-counting reaches in the same, multi-channel river.

#### 1.2 Discharge model

Each reach is associated with a mean annual discharge $\bar{Q}$ as modeled by the USGS [@u.s.geologicalsurveyNationalHydrographyDataset2022]. These are obtained through a runoff routing scheme that additionally accounts for evapotranspirative losses. We validate the discharge model for 1970-2018 using all USGS streamguages with sufficient data (Fig. S`r fig_nums_supp("val4", display="n")`- `r formatC(nDischargeValidation, format="d", big.mark=",")` gauges). This dataset was also supplemented with mean annual flow estimates from USGS streamgauges in ephemeral streams, as defined by various workers in USGS reports [@delongEstimatingAverageDissolvedsolids1988; @ranklRelationsTotalsedimentLoad2004; @heijljr.PRELIMINARYAPPRAISALEPHEMERALSTREAMFLOW1980; @schumerCharacteristicsEphemeralHydrographs2014; @elliottHydraulicGeometryStreamflow1986]. These 'ephemeral streamgauges' were each manually assessed via satellite imagery and hydrograph analysis to remove streamguages that more more representative of intermittent streams than ephemeral ones. For all other streamgauges, we separated non-perennial streams as those which (on average) run dry at least 5 days a year. Validation results are briefly discussed in Text S1 and plotted in Fig. S`r `b.

#### 1.3 Hydraulic Geometry

We use hydraulic geometry scaling to obtain estimates of mean annual river and lake/reservoir depth (necessary to assess ephemeralit- Section 3). For rivers, we use the relation from @brinkerhoffRemotelySensingRiver2022, who fit an equation of the form $H=c\bar{Q}^f$ on over 500,000 USGS in situ measurements of river channel depth *H* and discharge *Q* collected by @brinkerhoffReconcilingAtaStationAtManyStations2019. For lakes and reservoirs, we use mass-conservation to obtain average depths from lake/reservoir volume (*Vol*) and surface area *SA*. *Vol* was scaled using an equation of the form $Vol=a(SA)^{1.2}$ [@caelVolumeMeanDepth2017], developed using existing datasets and the Hurst coefficient for self-affine surfaces.

#### 1.4 Field data on stream ephemerality

We use a dataset of field assessments of 'stream ephemerality' to validate our stream classification model. This dataset comes from three sources: a) EPA WOTUS jurisdictional determinations [following @fesenmyerLargePortionUSA2021], b) USGS streamgauges, and c) field assessments of New England streams. Each dataset is described next.

The EPA WOTUS jurisdictional determinations dataset [@usepaCWAApprovedJDs] consists of field-site assessments made by EPA workers for WOTUS status made at the landowners request, where status was determined under the at-the-time definition for WOTUS extent. We use the data available as of 06/20/2022 when downloaded. We filter this dataset to include only determinations made under the NWPR after it was enacted in 2020, which includes an explicit category for ephemeral streams. This amounts to over 60,000 distinct jurisdictional determinations (including multiple determinations in the same reach, over space and time) and forms the bulk of our dataset. To make the dataset copacetic with our model, we remove data not associated with surface water features directly connected to the drainage network: adjacent/riparian wetlands, drylands, upland terrestrial sites, upland or non-adjacent wetlands/ponds/depressions, croplands, wastewater plants, and groundwater. We retained all other determinations that are directly connected to the drainage network (rivers, lakes, reservoirs, canals, ditches, stormwater control features, and artificial surface water features) and recast all determinations as ephemeral or non-ephemeral.

We supplement the jurisdictional determinations dataset with the USGS streamgauge network. Because the EPA jurisdictional determinations are done on a voluntary basis at the landowner's request, it is biased towards those surface water features whose WOTUS status is less apparent to the layperson. Thus, the EPA jurisdictional determinations rarely include larger (generally perennial) rivers. To make sure we are also correctly classifying these rivers, we use gauged rivers (section 1.2). All gauged rivers that, on average, are flowing 95% of the year (for 1970-2018) are assumed to be non-ephemeral, and are added to the dataset as such.

Finally, we manually assess stream ephemerality in the northeastern U.S. as our filtered and cleaned dataset includes no ephemeral reaches in this region. We follow the 'expert protocol' used by North Carolina's department of Water Quality for assessing stream ephemerality [@dorneyChapterNorthCarolina2018]. This protocol uses geomorphic, hydrologic, and biotic indicators of seasonally and/or permanently high water tables to assess stream permanence. We use our local knowledge to identify streams we thought are likely to be ephemeral, verify they are present in the NHD-HR hydrography (but do not look at the model result a priori to avoid biasing our assessments) and assess the channels following the protocol. Classification results are in Table S`r table_nums("field_data",display="n")` for the five sites. All streams are assessed over 48 hours from the most recent rain event to avoid the influence of delayed runoff in the channel that might be mistaken for baseflow. Note that we do not perform full soil assessments nor species counts as the protocol technically specifies, but instead perform rapid visual assessments that favor speed of classification over thoroughness. Per the protocol, none of these channels are close enough to being classified as intermittent (Table S`r table_nums("field_data",display="n")`) that we feel confident our rapid assessments are sufficient. While we only assess five ephemeral rivers, they provide at least some validation data in the northeastern U.S.

We join the three datasets to the hydrographic framework by snapping each field assessment to the nearest reach. Despite it's high resolution, the NHD-HR does not contain every stream in the U.S. and many of the field sites are not expected to be associated with a reach. In general, classification performance should decrease as the snapping threshold increases due to an assignment of field data to the wrong rivers, though we want to test how sensitive it actually is. First, we re-project all data using the Universal Transverse Mercator (UTM) projection system to ensure snapping distances are regionally accurate. Then, we test a range of snapping thresholds from 5m to 50m as a sensitivity test. Additional discussion on this sensitivity test is explained in Section 3.3. Ultimately, we settle on a threshold of 10m. This threshold also allows a direct comparison against the only existing ephemeral classification model [@fesenmyerLargePortionUSA2021], built using 10m flow accumulation data. After snapping, we assign the most frequently occurring field assessment along the reach as its 'true assessment of ephemerality'. If there is a tie between frequency of occurrence (meaning there is no consensus on whether the reach is ephemeral or non-ephemeral), we remove those points from the dataset. Ultimately, we have `r formatC(nrow(validationResults$validation_fin), format='d', big.mark=',')` field assessments of reach ephemerality to validate our model. Fig S2b maps the regional number of these data for all of CONUS.

### 2 Calculations
We calculate the ephemeral percent of streamflow (equation S1) and drainage area (equation S2) by routing through the drainage network from upstream to downstream. When a basin discharges into a downstream drainage network, we pass the exporting reach's value to the downstream basin's corresponding reach. Routing between basins was facilitated by a custom routine which runs the drainage network routing in parallel across basins at the same 'processing level' and then passes exported parameters of interest to the basins immediately downstream in the next processing level. To calculate the basin-exported value (Fig. `r fig_nums("figQ", display="n")`a and S`r fig_nums_supp("hydrographies", display="n")`), we sum up the ephemeral percents at all terminal reaches in the basin (sometimes rivers terminate endorheically and somtimes basins have two or more outlets) and then re-calculate equations S1 and S2. We also calculate the mean annual ephemeral flow frequency (equation S3).

More specifically, the ephemeral flow percent $E_Q$ (equation S1) is the mean percent of a reach's discharge that was 'ephemerally-sourced' (entered the drainage network in an upstream ephemeral channel) and weighted by each component's contribution to streamflow. *k* refers to each reach directly upstream and $Q_l$ is the lateral runoff contribution at the current reach. $E_{Q_l}$ is set to 1 for ephemeral streams and 0 for non-ephemeral streams. For losing streams (when discharge decreases downstream due to evapotranspirative losses or groundwater seepage), $E_Q_l$ is set to 0 as there is no lateral contribution to the stream channel. Equation S1 is mapped in Fig. `r fig_nums("figQ", display="n")`.

$$E_Q = \frac{\sum_{l=1}^K{E_{Q_k}{Q_k}}+E_{Q_l}Q_l}{\sum_{k=1}^K{Q_k}+Q_l}  \mathbf{(S1)}$$

The relative ephemeral area contribution $E_A$ (equation S2) is the mean percent of a reach's upstream drainage area *A* that is ephemeral, again weighted by each component's contribution to streamflow. Equation S2 is mapped in Fig. S`r fig_nums_supp("drainageAreaMap", display="n")`.
$$E_A = \frac{\sum_{k=1}^K{E_{A_k}{A_k}}+E_{A_l}A_l}{\sum_{k=1}^K{A_k}+A_l} \mathbf{(S2)}$$

At the basin scale, we calculate ephemeral flow frequency $E_f$ (equation S3) as the percent of an average year (in days) that ephemeral streams are flowing, where *i* is mean daily runoff depth, $i_{min}$ is a minimum runoff depth threshold for day *d* in the multi-year record *D*. This calculation is elaborated on in section 5. Equation S3 is mapped in Fig. `r fig_nums("figNflw", display="n")`a.

$$N_{flw} = \frac{\sum_{d=1}^{D}(i \geq i_{min})}{D}*365 \mathbf{(S3)}$$

### 3 Identifying ephemeral streams
#### 3.1 Model
We use a ~1km global soil hydrology model for mean monthly estimates of the water table depth (*WTD*)[@fanHydrologicRegulationPlant2017; @fanGlobalPatternsGroundwater2013]. Those authors coupled a vertical soil water balance with an inverse model that solves for groundwater recharge, lateral groundwater discharge, water table depth, and plant root uptake from evapotranspirative demand, inferred from remotely sensed leaf area index [@fanHydrologicRegulationPlant2017]. Their model ignores local, perched aquifers and anthropogenic pumping in favor of a broad, long-term average *WTD*, as is common in global-scale groundwater models [@condonGlobalGroundwaterModeling2021; @degraafHighresolutionGlobalscaleGroundwater2015]. Ignoring pumping likely leads to an underestimation of ephemeral streams, as the modeled water table is artificially high relative to the observed water table that has been lowered by pumping. Under this scenario, we likely misclassify ephemeral streams as perennial and thus underestimate the ephemeral influence on streamflow and water quality.

We extract the median *WTD* along each reach for `r formatC(sum(combined_results$n), format="d", big.mark=",")` discrete reaches across CONUS. We perform an initial classification of ephemeral/not ephemeral based solely on water table depth below the drainage feature: if *WTD* is deeper than river depth plus a 1cm buffer, for all twelve months of the year, it is classed as ephemeral. To avoid misclassifying streams with an intermittently high/low water table, this must hold true for all twelve months of the year. We treat all 'main ponded waters', i.e. lakes/reservoirs > 0.01 $km^2$ [@schmadelSmallPondsHeadwater2019], as non-ephemeral to ensure that perennial waterbodies are not mis-classified.

Then, we route through the network from upstream to downstream, cleaning up impossible scenarios and amending our initial classification to a more conservative estimate. Specifically, once a drainage path becomes 'not ephemeral', it must stay that way downstream over long-term averages. Even if it is a 'losing stream' this assumption must be true as the river will export some amount of water at least intermittently (even if very little). Finally, we handle two unique scenarios:

- Following NWPR rules, we only count rivers/streams as ephemeral and recast all ephemeral canals, ditches, and ponds (waterbodies <= 0.01 $km^2$) as non-ephemeral. These features fall under different WOTUS rules and are not the focus of this study.

- While Mexican and Canadian ephemeral streams contribute streamflow to the CONUS drainage network, they are not under U.S. jurisdiction and so are also recast as non-ephemeral.

#### 3.2 Validation

Ephemeral classification accuracy is assessed using the field assessment dataset (Section 1.4). We assess performance using regional classification accuracy, sensitivity (the true positive rate), specificity (the true negative rate), and "informedness", which is also called the true skill statistic (*TSS*) or Youden's *J* depending on the literature [@alloucheAssessingAccuracySpecies2006]. See Table S`r table_nums("classVal", display="n")` for metric definitions. *TSS* is equal to the sensitivity + specificity - 1. It intuitively represents the performance improvement over a random classifier, i.e. a score of zero indicates that the model is equivalent to random guessing. Mathematically, *TSS* equals the distance (in units of sensitivity) between a point on the receiver operating characteristic (ROC) curve and the random classifier. *TSS* is more robust to class imbalances than simple percent accuracy, and it has been used in the past to assess headwater and ephemeral mapping models [@fesenmyerLargePortionUSA2021; @russellSpatiallyExplicitModel2015; cavalloExploitingSentinel2Dataset2022], so we use it here to compare against existing studies. Regional accuracy is mapped in Fig. S`r fig_nums_supp("mainVal", display="n")`, regional *TSS* is mapped in Fig. S`r fig_nums_supp("val2", display="n")`, regional sensitivity and specificity are mapped in Fig. S3, and boxplots of all regional metrics are Fig. S`r fig_nums_supp("val4", display="n")`. To confirm our results are not dependent on the snapping threshold used, we test the sensitivity of CONUS-wide classification accuracy to the snapping threshold. As anticipated, performance steadily decreases as the snapping threshold increases (Fig. S`r fig_nums_supp("classificationSens", display="n")`). The choice of this threshold is elaborated on in Sections 1.4 and 3.3. The validation results are discussed in Text S1.

#### 3.3 Influence of hydrography resolution

As alluded to in Section 1.4, much of our ephemeral field data does not fall on the mapped drainage network and instead correspond to streams too small to be explicitly represented in our hydrography. While our drainage network framework is the highest resolution available, it inevitably has a lower bound on the streams that it includes. To assess the amount of ephemeral streams we are missing (and whether this matters for our model), we use Hortonian river network scaling [@hortonEROSIONALDEVELOPMENTSTREAMS1945] to extend the ephemeral stream network to best reproduce the observed distribution of the ephemeral field assessment dataset (section 1.4). This approach assumes the following:

- All scaled streams are ephemeral.

- Ephemeral streams aggregated from many CONUS drainage networks will fit a single Horton curve. This is valid as Horton ratios are a statistical inevitability of stream ordering and do not represent an inherent geomorphic process [@kirchnerStatisticalInevitabilityHorton1993; @miltonGeomorphicIrrelevanceDrainage1966; @bowdenEFFECTSTREAMORDERINGTECHNIQUE1964], but rather arise from hydrography resolution and channelization definitions. We use a consistent CONUS-scale product, so this is reasonable.

- The section 2 ephemeral field data is representative of the distribution of ephemeral streams across CONUS. Because these data consist of voluntary field assessments, it is very likely an underestimate of ephemeral stream presence. Actual estimates are likely even greater.

Equation S4 is the Horton law of stream numbers, which is a power-law function relating stream order $SO_m$ to the number of streams in the $m^{th}$ order $N_m$ [@hortonEROSIONALDEVELOPMENTSTREAMS1945]. $R_B$ is the Horton ratio and $N_{max}$ is the number of streams in the largest order. $R_B$ is solved via least-squares regression. Equation S4 can be re-expressed as equation S5, where *k* is the hypothetical ephemeral stream order(s) not associated with a reach in our model. Our validation data (section 1.4) provides us with $N_k$ (which is, again, likely underestimated), enabling the direct calculation of $SO_k$. We tested the sensitivity of this calculation to the snapping threshold used to join the validation data to the hydrography and find that the ephemeral river network most closely matches Hortonian theory with a snapping threshold of 5-15m (Fig. S`r fig_nums_supp("snappingSens", display="n")`-S8). Otherwise, this scaling relationship begins to break down.

$$N_m=N_{max}*R_B^{SO_{max} - SO_m} \mathbf{(S4)}$$

$$SO_k = \frac{log(N_k) - log(N_{max}) - SO_{max}log(R_B)}{-log(R_B)} \mathbf{(S5)}$$

Using equation S5, we find that one additional ephemeral stream order would need to be added to our drainage network to reproduce the field data distribution (Fig. S`r fig_nums_supp("scalingFig", display="n")`). Given the likely significant omission errors in our field ephemerality data, one additional stream order is a conservative estimate. We also find that `r perc_headwater_eph`% of headwater reaches are classified as ephemeral in our model, meaning that the missing stream order flows directly into reaches that are predominately ephemeral. Because of these results (and because streamflow and drainage area generally accumulate downstream), we can safely assume that out model headwaters implicitly represent the scaled ephemeral stream order as well, despite not being explicitly mapped in our hydrography.

### 4 Estimating ephemeral flow frequency
#### 4.1 Data
We estimate the flow frequency of ephemeral streams via the mean annual number of days per year that they flow ($N_{flw}$- equation S3). We do this using mean annual, weighted-average runoff data derived from USGS streamgauges [@brakebillDigitalHydrologicNetworks2011] and daily gridded precipitation for 1980-2006 [@xieGaugeBasedAnalysisDaily2007]. The model is purposefully simple but globally scalable (Fig. `r fig_nums("figQ_SO", display="n")`b).

We use field data only to determine an operational runoff threshold, as well to verify the model's performance. Note that field $N_{flw}$ data is quite uncommon and measured in very different ways at very different temporal resolutions. To our knowledge, we use all existing field data [@zimmerBidirectionalStreamGroundwater2017; @fritzCoarseParticulateOrganic2019; @kampfRainfallThresholdsFlow2018; @slaughterThirtyfiveYearsResearch2001; @stoneLongtermRunoffDatabase2008; @schoenerImpactUrbanizationStormwater2022; @strombergRiparianVegetationEphemeral2017; @peirceCharacterizingEphemeralStreams2015] that provides sufficient information to calculate $N_{flw}$ (Table S`r table_nums("Nflw_data", display="n")`). To get all data in a uniform format, we calculated mean annual $N_{flw}$ at each gauged stream (if applicable), then took the catchment average $N_{flw}$ across the gauged streams (again, if applicable). This averaging was not done in catchments with insufficient data and therefore significant uncertainties exist in many of these estimates that are presently not quantifiable.

Length of the timeseries varies significantly, from approximately 1/3 of a year in Guelph, Ontario to 45 years of sub-daily data in the Walnut Gulch Experimental Watershed in Arizona. Data from @peirceCharacterizingEphemeralStreams2015 exist for three sites within a catchment in Guelph, Ontario that do not flow into the United States. However, they are located approximately 15 km from one of our model basins that do flow into the U.S. (Fig. `r fig_nums("figNflw", display="n")`) and so we use that basin for verification. The Guelph, Ontario data is only for 1/3 of the year (approximately July to October). To obtain a mean annual estimate, we assumed the frequency of flow was the same year round, i.e. we tripled the $N_{flw}$ measured in their study. Likewise, the Robinson Forest data was only assessed for the latter half of a year, though reports indicate that flow only generally occurs 1-2 times in the remaining months [@fritzStructuralFunctionalCharacteristics2010], so we added that to the calculation. Finally, the Duke Forest site in North Carolina includes an intermittent main stem where the flow was recorded, however the rest of the drainage system is ephemeral [@zimmerBidirectionalStreamGroundwater2017].

#### 4.2 Model

Traditionally, streams are viewed as a surifical expression of groundwater [@winterGroundWaterSurface1999]. However, by definition ephemeral streams expand beyond the boundary of the surface extent of groundwater [@zimmerLateralVerticalLongitudinal2018]. Because they have no groundwater component, $N+{flw}$ is purely controlled by surface runoff and interflow. This assumption drastically simplifies our modeling and enables the calculation of $N_{flw}$ solely via runoff generation.

In that context, we first calculate a mean annual basin runoff ratio $i_r$ to convert precipitation *P* to stream runoff *i* and vice versa. The runoff ratio (equation S6) reflects the proportion of rainfall on the basin that winds up as stream runoff, where the implicit losses are via groundwater recharge and evapotranspiration. Using a mean annual $i_r$ also implicitly accounts for snowmelt runoff in winter.

$$i_r = \frac{i}{P} \mathbf{(S6)}$$

This runoff ratio and the 27 year daily gridded precipitation are used to determine how often runoff is generated in ephemeral streams (equation S3). Daily precipitation depths are converted to daily, basin-averaged stream runoffs using $i_r$. Streamflow then occurs when daily runoff exceeds some operational runoff threshold. We tally all days when flow occurs over the 27 years and calculate a mean annual $N_{flw}$, which is mapped in Fig. `r fig_nums("figNflw", display="n")`a. For a handful of basins on the Mexican/Canadian borders, there are no USGS gauges and no $i_r$ data. We use the mean annual runoff values from adjacent basins (the "closest" as assessed visually) and assume it holds constant in these basins. We perform a sensitivity test of the $i_r$ data, as it is biased towards USGS streamgauges and larger rivers. For this test, we use equation S3 and run the model under the four scenarios detailed in Table S`r table_nums("runoff_tests", display="n")`. At the basin-scale, results change only slightly (Fig. S`r fig_nums_supp("nFlwSens", display="n")`).

We also parameterize watershed 'memory': a bulk parameter representing the delayed arrival of runoff (lumped Dunnian, Hortonian, and/or interflow) to the drainage network. More practically, the memory parameter keeps streams 'turned on' for a number of days following a day identified as flowing. Memory parameter assignment was guided by a recent analysis [@mogesStrengthMemoryPrecipitation2022], which calculated the streamflow memory of rain events for 671 watersheds in CONUS, including many with groundwater influence. They found a median memory of approximately 4 days, which is used here.

The operational $i_{min}$ is determined using the $N_{flw}$ field data (section 4.1) as, to our knowledge, there is no theoretical consensus on what runoff depth defines a flowing stream. Thus, the operational definition of $i_{min}$ may change change with new additional field measurements of $N_{flw}$. We use the coefficient of determination $r^2$, the mean absolute error (*MAE*) and the root mean square error (*RMSE*) to determine the best performing $i_{min}$ of approximately 2.5 mm/day (Fig. `r fig_nums("figNflw", display="n")`b, Fig. S`r fig_nums_supp("runoffCalib", display="n")`).

#### 4.3 Verification

We verify the model against existing field measurements of ephemeral flow frequency (Text S1, Fig. `r fig_nums("figQ_SO", display="n")`b). Because of the limited available data on $N_{flw}$ and the necessary calibration of $i_{min}$, we refer to this as a model verification: all we can do is confirm that the model is reasonably realistic. We leave model refinement and constraining field-measured $N_{flw}$] to future work.

## Text S1: Model performance
### Discharge model performance
The discharge model accurately captures mean annual discharges for 1970-2018 across both perennial and non-perennial streams (Fig. S`r fig_nums_supp("mainVal", display="n")`). This performance is similar to another discharge model used to map global river intermittency [@messagerGlobalPrevalenceNonperennial2021].

### Classification performance
Ephemeral mapping performance varies across the United States. Regional average *TSS* is `r round(mean(val_shapefile_fin$basinTSS, na.rm=T),2)` (Fig. S`r fig_nums_supp("val2", display="n")`a), average regional accuracy is `r ceiling(mean(val_shapefile_fin$basinAccuracy)*100)`% (Fig. S`r fig_nums_supp("mainVal", display="n")`a), average regional sensitivity is `r ceiling(mean(val_shapefile_fin$basinSensitivity, na.rm=T)*100)`% (Fig. S`r fig_nums_supp("val3", display="n")`a) and average regional specificity was `r round(mean(val_shapefile_fin$basinSpecificity*100),0)`% (Fig. S`r fig_nums_supp("val3", display="n")`b). Performance is best in the northeastern U.S. and western U.S. (average *TSS* of `r round(mean(val_shapefile_fin[val_shapefile_fin$huc2 %in% goodAccuracy,]$basinTSS),2)`), while performance was worse in the Midwest and Great Plains (average *TSS* of `r round(mean(val_shapefile_fin[val_shapefile_fin$huc2 %in% badAccuracy,]$basinTSS),2)`). Specificity is uniformly strong across CONUS (Fig. S`r fig_nums_supp("val3", display="n")`b) but sensitivity is poor throughout the Great Plains and the western Gulf Coast (Fig. S`r fig_nums_supp("val2", display="n")`a). Overall, we outperform the only existing continental-scale ephemeral stream map [@fesenmyerLargePortionUSA2021], which reported a CONUS *TSS* of 0.45, sensitivity of 63%, and specificity of 83%.

### Field-scale performance in an experimental catchment
The Walnut Gulch experimental watershed in Arizona is home to one of the longest continuous ephemeral streamgauge records in the world and features a nested gauging scheme that enables whole-watershed studies for arid hydrology [@stoneLongtermRunoffDatabase2008]. The entire watershed drainage network is ephemeral. Here, we verify that our model 1) reproduces the completely-ephemeral drainage system (Fig. S`r fig_nums_supp("walnutGulch", display="n")`a) and 2) reproduces the mean annual ephemeral discharges throughout the drainage network (Fig. S`r fig_nums_supp("walnutGulch", display="n")`b).

### Equations S1 and S2 performance
At continental scales, it is impossible to validate equations S1 and S2 in a traditional sense. To broadly verify that our calculations make sense, we extend previous work by @alexanderRoleHeadwaterStreams2007, who used Tokunaga network scaling in the northeastern US to quantify relative headwater contributions to downstream discharge. Tokunaga ratios represent the average number of upstream ephemeral reaches that flow into the average reach per stream order [@zanardoAreAmericanRivers2013; @alexanderRoleHeadwaterStreams2007]. Assuming that discharge accumulates downstream, relative ephemeral Tokunaga ratios should be approximately similar to our routing calculations, i.e. if 50% of upstream rivers are ephemeral, than approximately 50% of streamflow is 'ephemerally-sourced' in a perfectly gaining watershed.

Here, we use Tokunaga ratios to calculate the average number of upstream ephemeral rivers per stream order, using network length rather than number of reaches due to the artificial paths necessary to incorporate lakes and reservoirs into the drainage network [@brinkerhoffLakeMorphometryRiver2021]. When compared against our equation S1 results (Fig S`r fig_nums_supp("mainVal", display="n")`c), this analysis confirms that our results are generally in line with those anticipated by network scaling theory.

## Supplementary Figures
![`r fig_nums_supp("mainVal", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/validationPlot.jpg)

![`r fig_nums_supp("val2", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/validationMap.jpg)

![`r fig_nums_supp("val3", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/validationMap2.jpg)

![`r fig_nums_supp("val4", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/boxPlots_classification.jpg)

![`r fig_nums_supp("walnutGulch", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/walnutGulch.jpg)

![`r fig_nums_supp("classificationSens", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/acc_sens_to_snapping.jpg)

![`r fig_nums_supp("scalingFig", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/scalingModel.jpg)

![`r fig_nums_supp("snappingSens", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/snappingThreshTradeOff.jpg)

![`r fig_nums_supp("runoffCalib", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/runoffThresh_fitting.jpg)

![`r fig_nums_supp("nFlwSens", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/boxPlots_sensitivity.jpg)

![`r fig_nums_supp("hydrographies", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/hydrographyMaps.jpg)

![`r fig_nums_supp("drainageAreaMap", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/drainageAreaMap.jpg)

## Supplementary Tables

**Table S`r table_nums("data_summary", display="n")`:** `r substr(table_nums("data_summary", display="full"), 11, nchar(table_nums("data_summary", display="full")))`

|Variable           | Dataset Name                                      | Spatial Resolution        | Temporal Resolution | Years captured | Reference                                                              |
|-------------------|---------------------------------------------------|---------------------------|---------------------|----------------|------------------------------------------------------------------------|
| Hydrography       | USGS National Hydrography dataset (NHD)           | 1:24,000                  | -                   | Long-term      | @u.s.geologicalsurveyNationalHydrographyDataset2022                    |
| Discharge         | USGS discharge model                              | 1:24,000                  | Year                | 1970-2000      | @u.s.geologicalsurveyNationalHydrographyDataset2022                    |
| Water Table Depth | Fan Global Soil Hydrology Model                   | 30"                       | Month               | 2004-2014      | @fanHydrologicRegulationPlant2017; @fanGlobalPatternsGroundwater2013   |
| Land Cover        | National Land Cover Dataset (NLCD)                | 30" (downscaled from 1")  | Year                | 2019           | @dewitzNationalLandCover2021                                           |
| Precipitation     | CPC Unified Gauge-based Daily Precipitation Model | 0.25'                     | Day                 | 1980-2006      | @xieGaugeBasedAnalysisDaily2007; @chenAssessingObjectiveTechniques2008 |
| Runoff            | USGS runoff data                                  | USGS level 4 basins       | Year                | 1970-2021      | @brakebillDigitalHydrologicNetworks2011                                |

**Table S`r table_nums("field_data", display="n")`:** `r substr(table_nums("field_data", display="full"), 11, nchar(table_nums("field_data", display="full")))`

```{r, echo=FALSE, message=FALSE}
df <- readr::read_csv('/nas/cee-water/cjgleason/craig/CONUS_ephemeral_data/for_ephemeral_project/new_england_fieldSites.csv')
df <- dplyr::select(df, c('name', 'lat', 'lon', 'score', 'classification'))

knitr::kable(df[, 1:5], format = "pipe", col.names = c('Name', 'Latitude', 'Longitude', 'Score', 'Classification'))

```

**Table S`r table_nums("classVal", display="n")`:** `r substr(table_nums("classVal", display="full"), 11, nchar(table_nums("classVal", display="full")))`

| Name                   | Definition                                          |
|------------------------|-----------------------------------------------------|
| Accuracy               | $\frac{N_{TP}+N_{TN}}{N_{TP}+N_{TN}+N_{FP}+N_{FN}}$ |
| Sensitivity            | $\frac{N_{TP}}{N_{TP}+N_{FN}}$                      |
| Specificity            | $\frac{N_{TN}}{N_{TN}+N_{FP}}$                      |
| True Skill Score (TSS) | Sensitivity + Specificity - 1                       |

**Table S`r table_nums("Nflw_data", display="n")`:** `r substr(table_nums("Nflw_data", display="full"), 11, nchar(table_nums("Nflw_data", display="full")))`

```{r, echo=FALSE}
df <- flowingDaysValidation
df$num_flowing_dys <- round(df$num_flowing_dys, 0)
df$n_flw_d <- round(df$n_flw_d, 0)
df <- df[,c(2,3,5,6,7,8,9)]
knitr::kable(df, format = "pipe", col.names = c('Model Basin', 'Model Nflw [dys]', 'Observed Nflw [dys]', 'Number Sample Years', 'Drainage Area [km2]', 'Number Sites','Reference'), row.names = FALSE)
```

**Table S`r table_nums("runoff_tests", display="n")`:** `r substr(table_nums("runoff_tests", display="full"), 11, nchar(table_nums("runoff_tests", display="full")))`

| Name          | Runoff ratio ($i_r$) |
|---------------|----------------------|
| Low runoff 1  | $i_r + 0.33i_r$      |
| Low runoff 2  | $i_r + 0.18i_r$      |
| High runoff 1 | $i_r - 0.33i_r$      |
| High runoff 2 | $i_r + 0.18i_r$      |

## References
