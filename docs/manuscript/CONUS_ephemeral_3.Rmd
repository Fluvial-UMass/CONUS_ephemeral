---
title: "Ephemeral stream contributions to United States drainage networks"
author:
  - Craig B Brinkerhoff:
      email: cbrinkerhoff@umass.edu
      institute: UMass
      correspondence: true
  - Colin J Gleason:
      institute: UMass
  - Matthew J Kotchen:
      institute: Yale1
  - Douglas Kysar:
      institute: Yale2
  - Peter A Raymond:
      institute: Yale1
institute:
  - UMass: Department of Civil & Environmental Engineering, University of Massachusetts Amherst, MA.
  - Yale1: School of the Environment, Yale University New Haven, CT.
  - Yale2: Yale Law School, Yale University, New Haven CT.
bibliography: References.bib
csl: science_csl.csl
output:
  word_document:
      fig_caption: yes
      pandoc_args:
        - '--lua-filter=scholarly-metadata.lua'
        - '--lua-filter=author-info-blocks.lua'
      reference_docx: word-styles-reference.docx
---

```{r, echo=FALSE, results='hide'}
library(targets)
library(captioner) #used to auto generate figure and Table numbers (so I stop going insane!)
setwd('/nas/cee-water/cjgleason/craig/CONUS_ephemeral') #R thinks it's in /manuscript...
source('src/utils.R') #getMode function

##############SET UP AUTOMATIC TABLE NUMBERING AND CAPTIONS--------------------------------
table_nums <- captioner::captioner(prefix = "Table")
table_nums(name = "data_summary",caption = "Summary of models and geospatial data used to drive our model and generate our results. Point-based data used to validate is described in sections 1.4 and 4.1.")

table_nums(name="field_data", caption="Field assessments of stream ephemerality performed in New England (Summer 2022). We followed the ephemeral/intermittent/perennial protocol for the State of North Carolina Department of Water Quality [@dorneyChapterNorthCarolina2018]. Scores < 19 are deemed 'ephemeral'.")

table_nums(name="classVal", caption="Classification metrics used to assess the ephemeral mapping model. N is number of sites, TP is the true positive rate, TN is the true negative rate, FP is the false positive rate, and FN is the false negative rate.")

table_nums(name="Nflw_data", caption="In situ measurements of mean annual number of flowing days for ephemeral streams, compared against the same value calculated via our model.")

table_nums(name="runoff_tests", caption="Runoff scenarios used in the $N_{flw}$ sensitivity analysis. See section 4.2 for more specifics.")

##############SET UP AUTOMATIC SUPP FIGURE NUMBERING AND CAPTIONS--------------------------------
fig_nums_supp <- captioner::captioner(prefix = "Figure")
fig_nums_supp(name = "mainVal",caption = "Main validation/verification of the various model components: (A) Regional classification accuracy of the ephemeral stream map against approximately 7,000 independent field assessments of stream ephemerality. (B) Validation of mean annual discharge model at approximately 4,000 streams across CONUS. (C) Verification that the percent of discharge exported from drainage networks that is ephemerally sourced is theoretically anticipated by basins' upstream ephemeral network extent. Only basins completely within the United States are used for this verification- see Text S1 for more details.")

fig_nums_supp(name = "val2",caption = paste0("Regional validation of the ephemeral stream map against approximately 7,000 independent field assessments of stream ephemerality: (A) regional model true skill score (TSS) and (B) number of field-observations per region. See Table S", table_nums("classVal", display="n"), " for metric definitions. The greyed-out region ('Souris-Red-Rainy basin') has no ephemeral validation data. See Text S1 for more details."))

fig_nums_supp(name = "val3",caption = "Regional validation of the ephemeral stream map against approximately 7,000 independent field assessments of stream ephemerality: (A) regional model classification sensitivity and (B) specificity. The greyed-out region ('Souris-Red-Rainy basin') has no ephemeral validation data. See Teaxt S1 for more details.")

fig_nums_supp(name = "val4",caption = paste0("Boxplots of regional ephemeral classification performance, by accuracy metric (section 3.2). Red dots correspond to the mean values. See Table S", table_nums("classVal", display="n"), " for metric definitions."))

fig_nums_supp(name = "walnutGulch",caption = "Field-scale model performance in the ephemeral Walnut Gulch experimental watershed. (A) Map of the model classification, indicating that we successfully identify the entire watershed as ephemeral (the 'non-ephemeral' reach is identified as a canal within the NHD-HR). (B) Validation of the mean annual discharge model at in-situ flumes within the watershed, which are also mapped in (A). For quality control, these flume data correspond to all sites whose reported drainage areas are within 20% of the drainage areas reported in the NHD-HR.")

fig_nums_supp(name = "classificationSens",caption = "Sensitivity of ephemeral classification to the snapping threshold used to join field data to the NHD-HR (section 3.3). Red points reflect the mean values.")

fig_nums_supp(name = "snappingSens",caption = paste0("Using stream order scaling to assess senstivity to the snapping threshold (sections 1.4). Points and lines represent the how well the field data fits expected network scaling theory (equation S4) given a snapping threshold to the NHD-HR. Purple is the root mean square error (RMSE) and green is the mean absolute error (MAE). Metrics should be smallest when the data best match Horton's laws, indicating that we are not missassinging field data to the wrong rivers."))

fig_nums_supp(name = "scalingFig",caption = paste0("Scaling model for CONUS ephemeral stream network. Orange points represent ephemeral streams explicitly associated with hydrography reaches while the green point represents ephemeral streams implicitly represented in our headwater hydrography (see section 3.4)."))

fig_nums_supp(name="nFlwSens", caption=paste0("Sensitivity test for $N_{flw}$ (section 4.2). The white boxplot is the distribution of the actual model results presented in the paper. Table S", table_nums("runoff_tests", display="n"), " details the runoff scenarios used to drive this senstivity test."))

fig_nums_supp(name = "runoffCalib",caption = "Determining an operational streamflow definition ($i_{min}$) using the available $N_{flw}$ data (section 4.2).")

fig_nums_supp(name="hydrographies", caption="Sample of 16/205 drainage network hydrographies classified using our model. Sub-plot titles refer to the relative and absolute values of discharge exported from drainage networks that is ephemerally sourced (equation S1). Note that foreign streams are mapped as 'not ephemeral' in these plots for visualization's sake (e.g. lower Colorado in sub-panel d).")

fig_nums_supp(name = "drainageAreaMap",caption = "Contiguous United States map of the percent of upstream drainage area that contributes to ephemeral streams (equation S2).")

##############SET UP AUTOMATIC FIGURE NUMBERING AND CAPTIONS--------------------------------
fig_nums <- captioner::captioner(prefix = "Figure")
fig_nums(name = "figQ",caption = paste0("Ephemeral stream water contributions to CONUS drainage networks. (A) Contiguous United States map of the percent of discharge exported from drainage networks that is ephemerally sourced (equation S1). (B-E) Drainage network maps and ephemeral export percents for four representative basins: (B) endorheic desert basin, (C) semi-arid western basin, (D) temperate, mountainous basin, and (E) a temperate, flat basin. Reach size corresponds to logarithmic bins of streamflow and is relative to map scale. Additional basins are mapped in Fig. S", fig_nums_supp("hydrographies", display="n"), ". For each basin we also provide the mean annual volume of exported water that is ephemerally sourced."))

fig_nums(name="figQ_SO", caption="Ephemeral stream water contributions internal to drainage networks. (A) Average percent of discharge that is ephemerally sourced by stream order, where boxplots are composed of CONUS basins and points/lines show the mean trend with river size. (B) Same, but for the average percent of upstream drainage area that is ephemeral. (C) Percent of CONUS drainage network length that is ephemeral. Note that only one network has 11 stream orders: the lower Columbia River.")

fig_nums(name="figNflw", caption="Frequency of ephemeral streamflow. (A) Contiguous United States map of the basin-average number of days that ephemeral streams flow per year, with points indicating approximate locations of field verification data. (B) Verification of model results with field data where SE refers to the standard error of the regression between predicted and measured values. (C) Histogram of model resuls from (A).")

##############LOAD IN RESULTS--------------------------------
#model results
tar_load(combined_results)
combined_results <- dplyr::filter(combined_results, !is.na(num_flowing_dys)) #remove great lakes
tar_load(combined_results_by_order)

#validation results
tar_load(val_shapefile_fin)
val_shapefile_fin <- val_shapefile_fin$shapefile
tar_load(flowingDaysValidation)
tar_load(combined_percEph_firstOrder)
tar_load(validationPlotMain) #Q validation df (to get n obs)
tar_load(validationResults) #ephemeral classification validation (to get n obs)

#SOME REGIONAL CATEGORIES FOR FURTHER STATS--------------------------------
combined_results$huc4 <- substr(combined_results$method, 9,13)
combined_results_by_order$huc4 <- substr(combined_results_by_order$method, 18,22)
east <- c('0101', '0102', '0103', '0104', '0105', '0106', '0107', '0108', '0109', '0110',
          '0202', '0203', '0206', '0207', '0208', '0204', '0205',
          '0301', '0302', '0303', '0304', '0305', '0306', '0307', '0308', '0309', '0310', '0311', '0312', '0313', '0314', '0315', '0316', '0317', '0318',
          '0401', '0402', '0403', '0404', '0405', '0406', '0407', '0408', '0409', '0410', '0411', '0412', '0413', '0414', '0420', '0427', '0429', '0430',
          '0501', '0502', '0503', '0504', '0505', '0506', '0507', '0508', '0509', '0510', '0511', '0512', '0513', '0514',
          '0601', '0602', '0603', '0604',
          '0701', '0703', '0704', '0705', '0707', '0709', '0712', '0713', '0714',
          '0801', '0803', '0806', '0807', '0809',
          '0901', '0902', '0903', '0904')
west <- combined_results[!(combined_results$huc4 %in% c(east)),]$huc4

southwest <- c('13', '14', '15')

badAccuracy <- c('08', '05', '06')
goodAccuracy <- c('01', '02', '18', '17', '15', '14', '13')

############SUMMARISE RESULTS-----------------------------
#stats for Q
relativeExport <- summary(combined_results$percQEph_exported)
relativeExport_da <-  summary(combined_results$percAreaEph_exported)
relativeExport_order1 <- summary(combined_results_by_order[combined_results_by_order$StreamOrde==1,]$percQEph_reach_mean)

relativeExportEast_order1 <- summary(combined_results_by_order[combined_results_by_order$StreamOrde==1 & combined_results_by_order$huc4 %in% east,]$percQEph_reach_mean)
relativeExportWest_order1 <- summary(combined_results_by_order[combined_results_by_order$StreamOrde==1 & combined_results_by_order$huc4 %in% west,]$percQEph_reach_mean)

overFifty <- sum(combined_results$percQEph_exported > 0.50)

mississippi <- tar_read(results_0809)
columbia <- tar_read(results_1708)

#calculate flow frequency numbers
meanFlowFreq <- round(mean(combined_results$num_flowing_dys),0)
relativeFlowFreq <- round((mean(combined_results$num_flowing_dys)/365)*100,0) #%
flowingDaysValidation$n_flw_d <- round(flowingDaysValidation$n_flw_d, 0)
flowingDaysValidation$num_flowing_dys <- round(flowingDaysValidation$num_flowing_dys, 0)
Nflw_se <- round(summary(lm(num_flowing_dys~n_flw_d, data=flowingDaysValidation))$sigma,0) #model standard error, i.e. uncertainty

#validation numbers and results
nreaches <- sum(combined_results$n_total)
nDischargeValidation <- nrow(validationPlotMain)
nMapValidation <- nrow(validationResults$validation_fin)
perc_riverSource_eph <- round((sum(combined_percEph_firstOrder$lenKM_eph_source, na.rm=T) / sum(combined_percEph_firstOrder$lenKM_source, na.rm=T))*100,0) #%ephemeral for source reaches with no upstream reaches
perc_firstOrder_eph <- round((sum(combined_percEph_firstOrder$lenKM_eph_firstOrder, na.rm=T) / sum(combined_percEph_firstOrder$lenKM_firstOrder, na.rm=T))*100,0) #%ephemeral for source reaches with no upstream reaches
```

## One-Sentence Summary
Ephemeral streams contribute a significant portion of freshwater to drainage networks and implicate downstream water quality.

## Abstract
Ephemeral streams flow only in direct response to precipitation and are ubiquitous landscape features. However, little is known about ephemeral streams' influence on downstream flow rates and water chemistry, potentially creating issues for water quality regulation [@departmentofthearmycorpsofengineersNavigableWatersProtection2020]. Here, we model ephemeral stream water contributions to the contiguous United States network of `r formatC(nreaches, format="d", big.mark=",")` rivers, lakes, reservoirs, canals, and ditches, finding that they contribute on average `r round(relativeExport[4]*100,0)`% of the discharge exported from drainage networks while flowing on average `r meanFlowFreq` $\pm$ `r Nflw_se` days a year. This significant contribution is facilitated by small headwater streams, where on average `r round(relativeExport_order1[4]*100,0)`% of headwater streamflow is ephemeral. The ephemeral terrestrial-aquatic connection is therefore a substantial pathway through which pollution (and other solutes) may enter the downstream perennial drainage network and influence water quality.

## Main Text
Streams transport nutrients, sediments, pollutants, and other solutes from the land surface to rivers, lakes, reservoirs, and ultimately the oceans [@raymondHydrologicalBiogeochemicalControls2016; @heAssessmentGlobalNitrogen2011; @schmidtExportPlasticDebris2017; @liuRiversLargestSource2021; @battinRiverEcosystemMetabolism2023], influencing all downstream water quality [@alexanderFeaturedCollectionIntroduction2018; @harveyHowHydrologicConnectivity2019a; @keiserConsequencesCleanWater2019]. The most upland streams (hereafter headwaters) are often 'ephemeral' streams, which flow only in direct response to precipitation and are disconnected from groundwater year-round, unlike larger downstream rivers.  Non-perennial streams (which include ephemeral and intermittently dry rivers) account for over half of the global river network [@messagerGlobalPrevalenceNonperennial2021]. While much recent work has developed classification models to map non-perennial stream extent [@messagerGlobalPrevalenceNonperennial2021; @jaegerProbabilityStreamflowPermanence2019; @durighettoProbabilisticDescriptionStreamflow2022; @russellSpatiallyExplicitModel2015; @fesenmyerLargePortionUSA2021; @cavalloExploitingSentinel2Dataset2022], nearly no work focuses specifically on ephemeral streams [@fesenmyerLargePortionUSA2021] and all work stopped short of assessing the hydrological contributions of non-perennial streams to the overall drainage network at broad spatial scales. It is regionally established that headwater streams contribute meaningfully to downstream water quantity and quality [@alexanderRoleHeadwaterStreams2007; @fritzPhysicalChemicalConnectivity2018], but we presently have no explicit assessment of ephemeral contributions to global hydrology, nor their potential influence on downstream water quality.

In this context, here we use a simple geomorphic model to identify ephemeral streams by comparing long-term water table depths with streamline presence in `r formatC(nreaches, format="d", big.mark=",")` discrete streams, rivers, lakes, reservoirs, canals, and ditches across the contiguous United States (CONUS) [@MaterialsMethodsAre]. We use published groundwater, discharge, runoff, and precipitation models [@u.s.geologicalsurveyNationalHydrographyDataset2022; @brakebillDigitalHydrologicNetworks2011; @xieGaugeBasedAnalysisDaily2007] and a river-lake-reservoir routing framework [@brinkerhoffLakeMorphometryRiver2021] to first map ephemeral streams, and then quantify the fraction of every river's mean annual discharge that was contributed by upstream CONUS ephemeral streams. We also quantify how frequently ephemeral streams flow [@MaterialsMethodsAre]. We define and discuss the metrics that make up our assessment (equations S1-S3), validate individual model components at up to `r formatC(nMapValidation, format="d", big.mark=",")` sites across CONUS (Text S1, Figs. S`r fig_nums_supp("mainVal", display="n")`-S`r fig_nums_supp("walnutGulch", display="n")`), and test parameter sensitivity when necessary (Figs. S`r fig_nums_supp("classificationSens", display="n")`-S`r fig_nums_supp("nFlwSens", display="n")`) [@MaterialsMethodsAre].

### The ephemeral pulse of drainage networks
On average, `r round(relativeExport[4]*100,0)`% of annual drainage network discharge (by water volume) is sourced from upstream ephemeral streams (Fig. `r fig_nums("figQ", display="n")`). This varies significantly across basins (from `r round(relativeExport[1]*100,0)`% to `r round(relativeExport[6]*100,0)`%), with generally greater ephemeral influence in basins west of the Mississippi River. Hereafter, we refer to this region as 'West', with basins east of the Mississippi River refereed to as 'East'. Regional hotspots occur where ephemeral streams most dominate the landscape, namely the desert and endorheic basins of the southwest and Great Basin (Fig. `r fig_nums("figQ", display="n")`a, Fig. S`r fig_nums_supp("hydrographies", display="n")`). However, ephemeral contributions to discharge are consistently high across across CONUS: `r round((overFifty/nrow(combined_results))*100,0)`% of networks export water that is at least 50% ephemeral and the largest rivers in the United States export large volumes of ephemeral water: the Mississippi River export is `r round(mississippi$percQEph_export*100,0)`% originating from ephemeral reaches and the Colombia river export is `r round(columbia$percQEph_export*100,0)`% ephemeral. We also express the ephemeral contribution to discharge as a function of drainage area (Fig. S`r fig_nums_supp("drainageAreaMap", display="n")`, equation S2), where on average `r round(relativeExport_da[4]*100,0)`% of a basin's upstream drainage area is ephemeral and there is a clear east/west divide in land surface contributions to drainage networks. Given that freshwater generally accumulates in drainage networks that follow predictable scaling patterns [@tarbotonFractalNatureRiver1988; @zanardoAreAmericanRivers2013; @doddsScalingUniversalityGeomorphology2000; @tokunagaConsiderationsCompositionDrainage1978; @alexanderRoleHeadwaterStreams2007], our results (Fig. `r fig_nums("figQ", display="n")`a) are theoretically anticipated by the average upstream ephemeral network extent (Fig. S`r fig_nums_supp("mainVal", display="n")`c, Text S1). Our results also support previous modeling in northeastern CONUS, where 70% of exported streamflow is sourced from headwater streams, regardless of their ephemerality [@alexanderRoleHeadwaterStreams2007].

![Fig. `r fig_nums("figQ", display="n")`: `r substr(fig_nums("figQ", display="full"), 12, nchar(fig_nums("figQ", display="full")))`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/paper_figures/fig1.jpg)

Ephemeral stream hydrography, largely governed by lateral groundwater fluxes and watershed geomorphology, is a result of both topography and climate [@gleesonClassifyingWaterTable2011; @condonEvaluatingRelationshipTopography2015]. In the East, ephemeral streams are most numerous in upland settings, where they sit upslope of the groundwater point of emergence (e.g. Figs. `r fig_nums("figQ", display="n")`d, `r fig_nums("figQ", display="n")`e, S`r fig_nums_supp("hydrographies", display="n")`). In much of the West, where the water table is kilometers below the surface, ephemeral streams can dominate the landscape (Figs. `r fig_nums("figQ", display="n")`b, `r fig_nums("figQ", display="n")`c, S`r fig_nums_supp("hydrographies", display="n")`). The Great Lakes/Midwest region and Florida have the smallest ephemeral influence due to low-order networks with persistently shallow water tables [@fanHydrologicRegulationPlant2017]. The Midwest region is also strongly influenced by artificial irrigation ditches, which are not natural ephemeral streams but contribute significantly to discharge.

Internal to drainage networks, stream size exerts a fundamental control on the ephemeral contribution to river hydrology (Fig. `r fig_nums("figQ_SO", display="n")`). On average, first-order discharge is `r round(relativeExport_order1[4]*100,0)`% ephemerally sourced across all CONUS basins (Fig. `r fig_nums("figQ_SO", display="n")`a). This result varies predictably east and west of the Mississippi River (`r round(relativeExportEast_order1[4]*100,0)`% versus `r round(relativeExportWest_order1[4]*100,0)`%, respectively). Given the first-order control of topography on eastern ephemeral stream presence (Fig. `r fig_nums("figQ", display="n")`), the eastern ephemeral contribution decreases rapidly to approximately 60% in large rivers, while in western basins it decreases more slowly- and linearly with stream order (Fig. `r fig_nums("figQ_SO", display="n")`a). The ephemeral drainage area percent decreases similarly with stream size (Fig `r fig_nums("figQ_SO", display="n")`b). Overall, these results are driven by the sheer extent of ephemeral steams in orders 1-3 in the east and 1-5 in the west (Fig `r fig_nums("figQ_SO", display="n")`c).

![Fig. `r fig_nums("figQ_SO", display="n")`: `r substr(fig_nums("figQ_SO", display="full"), 12, nchar(fig_nums("figQ_SO", display="full")))`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/paper_figures/fig2.jpg)

We limit our ephemeral stream analysis to CONUS ephemeral streams as Mexican/Canadian rivers fall under different water quality regulation, as well as all ephemeral canals, ditches, and ponds [@MaterialsMethodsAre]. We also do not account for human groundwater pumping [@MaterialsMethodsAre; @fanHydrologicRegulationPlant2017; @fanGlobalPatternsGroundwater2013] and thus are likely under-estimating ephemeral streams where pumping is significant. Ephemeral streams will only become more frequent as groundwater pumping intensifies and water tables lower further [@goodrichSouthwesternIntermittentEphemeral2018; @scanlonGroundwaterDepletionSustainability2012; @jasechkoWidespreadPotentialLoss2021]. Overall, our analysis represents a conservative estimate of ephemeral hydrography and the ephemeral pulse of CONUS drainage networks.

![Fig. `r fig_nums("figNflw", display="n")`: `r substr(fig_nums("figNflw", display="full"), 12, nchar(fig_nums("figNflw", display="full")))`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/paper_figures/fig3.jpg)

The significance of the ephemeral contribution to drainage networks (Figs. `r fig_nums("figQ", display="n")`-`r fig_nums("figQ_SO", display="n")`) is underpinned by how often they flow (Fig. `r fig_nums("figNflw", display="n")`). Ephemeral streams flow on average `r meanFlowFreq` $\pm$ `r Nflw_se` days per year across all basins, but with most basins flowing only 0-10 days in an average year (Fig. `r fig_nums("figNflw", display="n")`c). Ephemeral flow frequency manifests as a balance of evapotranspiration, the size and frequency of precipitation events, and antecedent moisture conditions influencing runoff generation. For example, in western basins ephemeral streams only flow `r  round(mean(combined_results[combined_results$huc4 %in% west, ]$num_flowing_dys),0)` days a year on average, while they flow `r  round(mean(combined_results[combined_results$huc4 %in% east, ]$num_flowing_dys),0)` days on average in eastern basins. In the arid southwestern United States, this drops to an average of `r round(mean(combined_results[substr(combined_results$huc4,1,2) %in% southwest, ]$num_flowing_dys),0)` days a year. Our simple model uses only a gridded precipitation timeseries, runoff data, and an operational definition for streamflow [@MaterialsMethodsAre]. It reasonably matches in situ sensor data of catchment-averaged ephemeral flow frequency (Fig. `r fig_nums("figNflw", display="n")`b). With that said, we stress that extremely little data exists on ephemeral flow frequency at the drainage network scale (Fig. `r fig_nums("figNflw", display="n")`b). Future work should explore ephemeral runoff generation across distributed sensor networks to refine our modeling.

### Downstream threats to water quality
Given such infrequent flow, our results suggest that ephemeral streams likely dominate drainage network responses to storm events, shunting pollutants and other solutes downstream at even greater rates than suggested here under mean annual conditions [@raymondHydrologicalBiogeochemicalControls2016]. The exact impacts of ephemeral discharge on constituent loads and concentrations will be context dependent. The delivery of most elements, nutrients and pollutants, however, scale with discharge [@raymondHydrologicalBiogeochemicalControls2016; @catalanPulseShuntStorage2022] and are dominated by inputs from headwater streams (of which `r perc_firstOrder_eph`% of CONUS first order stream extent is ephemeral according to our model). Thus, we would expect the importance and impacts of ephemerally sourced water on stream and river chemistry to be high in downstream regions that have accumulated large ephemeral water contributions.

Ephemeral streams' regulated status under the United States Clean Water Act (CWA) has been a long-debated and often contentious topic [@keiserEvolutionWatersUnited2022]. Ephemeral streams have received considerable attention from environmental groups, farm lobbying groups, and politicians since the CWA was enacted in 1972 [@sullivanDistortingSciencePutting2020; @alexanderFeaturedCollectionIntroduction2018; @departmentofthearmycorpsofengineersNavigableWatersProtection2020].

*Room here for a paragraph or two to flesh out implications, regulations, policy, etc. from Doug and Matt.*

## References
references need to be moved here manually

## Acknowledgements

### General
We thank Dr. Ying Fan Reinfelder, the USGS, and the EPA for making their data and/or models freely available. We also thank Brian Saccardi for helping manually verify portions of the basin routing scheme. All modeling was performed on the Unity cluster at the Massachusetts Green High Performance Computing Center (MGHPCC).

### Funding
- Please comment any funding you want to add!!

- Craig Brinkerhoff: FINESST/WROL

### Author Contributions

-   Conceptualization: PAR, CBB, MJK, DK

-   Methodology: CBB, PAR, CJG

-   Investigation: CBB, PAR, CJG, MJK, DK

-   Visualization: CBB

-   Supervision: PAR

-   Writing- original draft: CBB

-   Writing- review & editing: CBB, CJG, PAR, MJK, DK

### Competing interests
Authors declare that they have no competing interests.

### Data and materials availability
blah blah blah.

## Supplementary Materials

-   Materials and Methods

-   Text S1

-   Figs. S1 to S12

-   Tables S1 to S5

-   References 36-68

\newpage

<center>

![](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/docs/manuscript/science_logo.jpg)

# Supplementary Materials for

Ephemeral stream contributions to United States drainage networks

C.B. Brinkerhoff, C.J. Gleason, M.J. Kotchen, D. Kysar, P.A. Raymond

Correspondence to cbrinkerhoff@umass.edu

</center>

## This PDF file includes:

-   Materials and Methods

-   Text S1

-   Figs. S1 to S12

-   Tables S1 to S5

## Materials and Methods

All modeling and analysis was performed on the Unity Cluster at the Massachusetts Green High Performance Computing Center (MGHPCC) using publicly available datasets, models, and entirely free and open-source geoprocessing tools in the R programming language. All data and models used in this analysis are described in Table S`r table_nums('data_summary', display='n')`.

### 1 Drainage network framework

#### 1.1 Overview

We use the United States Geological Survey (USGS) National Hydrography Dataset High-Resolution (NHD-HR) built at 1:24,000 map scale [@u.s.geologicalsurveyNationalHydrographyDataset2022] for our drainage network hydrography, which is still in development by the USGS. We use the data publicly available as of Spring 2022. This is the highest resolution hydrography data available and is often treated as a gold-standard to benchmark hydrography models against. The NHD-HR is discretized into 'reaches', which correspond to mass-conserved segments of rivers, streams, ditches, canals, lakes, and reservoirs. The NHD-HR uses artificial flowpaths to maintain network topology through lakes and reservoirs, and here we use a previously developed routing framework to handle complex lakes/reservoirs with multiple river inputs during our routing [@brinkerhoffLakeMorphometryRiver2021]. The NHD-HR also includes nested drainage basins across 12 scales. We run our model at the 4th level and our mapping validation at the 2nd level. This was done based on data resolution, data availability across the United States, and ease of interpretation.

As will all human-built products, NHD-HR data quality varies across CONUS. We identified significantly higher drainage densities in the NHD-HR for the state of Indiana (often 1-2x the stream orders as other portions of a given basin in adjacent U.S. states). For these basins, we manually removed the lowest 1 or two stream orders within the Indiana portions of these basins, until the whole-basin drainage density was visually consistent across state lines. We also remove all divergent reaches, i.e. minor flowpaths that diverge from the main downstream path of flow. We do not remove the rest of the flowpath downstream of a divergent reach if there was another, non-divergent source that joined and made the path no longer divergent. Divergent channels are generally alternative flowpaths in multi-channel rivers, and so we remove them to avoid double-counting rivers.

#### 1.2 Discharge model

Each reach is associated with a mean annual discharge $\bar{Q}$ as modeled by the USGS [@u.s.geologicalsurveyNationalHydrographyDataset2022]. These are obtained through a runoff routing scheme that accounts for evapotranspirative losses. We validate the discharge model for 1970-2018 using all USGS streamguages with data for that time period. This dataset is also supplemented with mean annual flow estimates from USGS streamgauges in ephemeral streams, as defined by various workers in USGS reports [@delongEstimatingAverageDissolvedsolids1988; @ranklRelationsTotalsedimentLoad2004; @heijljr.PRELIMINARYAPPRAISALEPHEMERALSTREAMFLOW1980; @schumerCharacteristicsEphemeralHydrographs2014; @elliottHydraulicGeometryStreamflow1986]. We manually verify that these 'ephemeral streams' are actually ephemeral and not more representative of an intermittent river via satellite imagery and hydrograph analysis. For all other streamgauges, we identify non-perennial streams as those which (on average) run dry at least 5 days a year. Validation results are discussed in Text S1 and plotted in Fig. S`r fig_nums_supp("mainVal", display="n")`b. In total, we validate the discharge model at `r formatC(nDischargeValidation, format="d", big.mark=",")` rivers.

#### 1.3 Hydraulic Geometry

We use hydraulic geometry scaling to obtain estimates of mean annual river and lake/reservoir depth (necessary to assess ephemerality- Section 3.1). For rivers, we use the relation from @brinkerhoffRemotelySensingRiver2022, who fit an equation of the form $H=c\bar{Q}^f$ on over 500,000 USGS in situ measurements of river channel depth *H* and discharge *Q* colated by @brinkerhoffReconcilingAtaStationAtManyStations2019. For lakes and reservoirs, we use mass-conservation to obtain average depths from lake/reservoir volume (*Vol*) and surface area *SA*. *Vol* was scaled using an equation of the form $Vol=a(SA)^{1.2}$ [@caelVolumeMeanDepth2017], developed using a global dataset and the Hurst coefficient for self-affine surfaces (a = 0.533).

#### 1.4 Field data on stream ephemerality

We use a dataset of field assessments of 'stream ephemerality' to validate our stream classification model. This dataset comes from three sources: 1) EPA WOTUS jurisdictional determinations [following @fesenmyerLargePortionUSA2021], 2) USGS streamgauges, and 3) field assessments of New England streams. Each dataset is described next.

The EPA WOTUS jurisdictional determinations dataset [@usepaCWAApprovedJDs] consists of field assessments performed by EPA workers made at landowners' requests, where status was determined under the at-the-time definition for WOTUS extent. We use the data available as of 06/20/2022 when downloaded. We filter this dataset to include only determinations made under the NWPR after it was enacted in 2020, which includes an explicit category for ephemeral streams. This amounts to over 60,000 distinct jurisdictional determinations (often including multiple determinations in the same reach, over space and time) and forms the bulk of our dataset. To make the dataset copacetic with our model, we remove data not associated with surface water features directly connected to the drainage network: adjacent/riparian wetlands, drylands, upland terrestrial sites, upland or non-adjacent wetlands/ponds/depressions, croplands, wastewater plants, and groundwater. We retained all other determinations that are directly connected to the drainage network (rivers, lakes, reservoirs, canals, ditches, stormwater control features, and artificial surface water features) and recast all determinations as ephemeral or non-ephemeral.

We supplement the jurisdictional determinations dataset with the USGS streamgauge network. Because the EPA jurisdictional determinations are done on a voluntary basis at landowners' requests, it is biased towards those surface water features whose WOTUS status is not so easily discerned. Thus, the EPA jurisdictional determinations rarely include larger (usually perennial) rivers. To make sure we are also correctly classifying larger rivers, we include gauged rivers (section 1.2) in our validation. All gauged rivers that, on average, are flowing 95% of the year (for 1970-2018) are conservatively assumed to be non-ephemeral, and are added to the dataset as such.

Finally, we manually assess stream ephemerality in the northeastern U.S. because our validation data includes no ephemeral reaches in this region. We follow the 'expert protocol' used by North Carolina's department of Water Quality for assessing stream ephemerality [@dorneyChapterNorthCarolina2018]. This protocol uses geomorphic, hydrologic, and biotic indicators of seasonally and/or permanently high water tables to assess stream permanence. We use our local knowledge to identify streams we thought are likely to be ephemeral, verify they are present in the NHD-HR (but do not look at the model result a priori to avoid biasing our assessments) and assess the channels following the protocol. Classification results are in Table S`r table_nums("field_data",display="n")` for the five sites. All streams are assessed over 48 hours from the most recent rain event to avoid the influence of delayed runoff in the channel that might be mistaken for baseflow. Note that we do not perform full soil assessments nor species counts as the protocol technically specifies, but instead perform rapid visual assessments that favor speed of classification over thoroughness. Per the protocol, none of these channels are close enough to being classified as intermittent (Table S`r table_nums("field_data",display="n")`) that we feel confident our rapid assessments are sufficient. While we only assess five ephemeral rivers, they provide at least some validation data in the northeastern U.S.

We join the three datasets to the hydrographic framework by snapping each field assessment to the nearest reach. Despite it's high resolution, the NHD-HR does not contain every stream in CONUS and many of the field sites are not expected to be associated with a reach. We settle on a threshold of 10m. The tests and rationale used to drive this decision are explained in section 3.3. After snapping, we assign the most frequently occurring field assessment along the reach as its 'true assessment of ephemerality'. If there is a tie between frequency of occurrence (meaning there is no consensus on whether the reach is ephemeral or non-ephemeral), we remove those points from the dataset. Ultimately, we have `r formatC(nrow(validationResults$validation_fin), format='d', big.mark=',')` field assessments of reach ephemerality to validate our model. Fig S2b maps the regional distribution of these data.

### 2 Calculating ephemeral contributions
We calculate the ephemeral percent of streamflow (equation S1) and drainage area (equation S2) for all `r formatC(nreaches, format="d", big.mark=",")` reaches by routing through the drainage network from upstream to downstream. When a basin discharges into a downstream drainage network, we pass the exporting reach's value to the downstream basin's corresponding reach. Routing between basins was facilitated by a custom routine which runs the drainage network routing in parallel across basins at the same 'processing level' and then passes exported parameters of interest to the basins immediately downstream in the next processing level. To calculate the basin-exported value (Fig. `r fig_nums("figQ", display="n")`a and S`r fig_nums_supp("drainageAreaMap", display="n")`), we sum up the ephemeral percents at all terminal reaches in the basin (sometimes rivers terminate endorheically and occasionally basins have two or more outlets) and then re-calculate equations S1 and S2. We also calculate the mean annual ephemeral flow frequency (equation S3, section 4).

More specifically, the ephemeral percent of streamflow $E_Q$ (equation S1) is the mean percent of a reach's discharge that was 'ephemerally sourced' (entered the drainage network in an upstream ephemeral channel). It is the average of each streamflow source's ephemeral contribution, weighted by discharge. *k* refers to each reach directly upstream and $Q_l$ is the lateral runoff contribution at the current reach. $E_{Q_l}$ is set to 1 for ephemeral streams and 0 for non-ephemeral streams. For losing streams (when discharge decreases downstream due to evapotranspirative losses or groundwater seepage), $E_Q_l$ is set to 0 as there is no lateral contribution into the stream channel. Equation S1 is mapped in Fig. `r fig_nums("figQ", display="n")`a.

$$E_Q = \frac{\sum_{k=1}^K{(E_{Q_k}{Q_k}})+E_{Q_l}Q_l}{\sum_{k=1}^K{(Q_k)}+Q_l}  \mathbf{(S1)}$$

The ephemeral percent of drainage area $E_A$ (equation S2) is the mean percent of a reach's upstream drainage area, where *A* is the upstream drainage area. We again using the weighted average of each component's contribution to streamflow. Equation S2 is mapped in Fig. S`r fig_nums_supp("drainageAreaMap", display="n")`.
$$E_A = \frac{\sum_{k=1}^K{(E_{A_k}{A_k}})+E_{A_l}A_l}{\sum_{k=1}^K{(A_k)}+A_l} \mathbf{(S2)}$$

Finally, we calculate basin-average ephemeral flow frequency $E_f$ (equation S3) as the percent of an average year (in days) that ephemeral streams are flowing, where *i* is mean daily runoff depth and $i_{min}$ is an operational runoff threshold for day *d* in the multi-year record *D*. This calculation is elaborated on in section 4. Equation S3 is mapped in Fig. `r fig_nums("figNflw", display="n")`a.

$$N_{flw} = \frac{\sum_{d=1}^{D}(i \geq i_{min})}{D}*365 \mathbf{(S3)}$$

### 3 Identifying ephemeral streams
#### 3.1 Model
We use a ~1km global soil hydrology model for mean monthly estimates of the water table depth (*WTD*)[@fanHydrologicRegulationPlant2017; @fanGlobalPatternsGroundwater2013]. This model couples a vertical soil water balance with an inverse model that solves for groundwater recharge, lateral groundwater discharge, water table depth, and plant root uptake from evapotranspirative demand as inferred via remotely sensed leaf area index [@fanHydrologicRegulationPlant2017]. It ignores local, perched aquifers and anthropogenic pumping in favor of a broad, long-term average *WTD*, as is common in global-scale groundwater models [@condonGlobalGroundwaterModeling2021; @degraafHighresolutionGlobalscaleGroundwater2015]. Ignoring pumping likely leads to an underestimation of ephemeral streams, as the modeled water table is artificially high relative to the observed water table that has been lowered by pumping. Under this scenario, we likely misclassify ephemeral streams as perennial and thus underestimate the total ephemeral influence in an intensively pumped basin.

We extract the median *WTD* along all `r formatC(sum(combined_results$n_total), format="d", big.mark=",")` discrete reaches for all 12 months. We perform an initial classification of ephemeral/non-ephemeral based solely on water table depth below the reach: if *WTD* is deeper than river/lake/reservoir depth plus a 1cm buffer, for all twelve months of the year, it is classed as ephemeral. To avoid misclassifying streams with an intermittently high/low water table, this must hold true for all twelve months of the year. We treat all 'main ponded waters', i.e. lakes/reservoirs $\geq 0.01 km^2$ [@schmadelSmallPondsHeadwater2019], as non-ephemeral to ensure that perennial waterbodies are not mis-classified.

Then, we route through the network from upstream to downstream, cleaning up impossible scenarios and amending our initial classification to a more conservative estimate. Specifically, if a drainage path has a perennial/intermittent river or main ponded water upstream of it, the current reach must also be non-ephemeral. Even if the upstream river only provides an intermittent groundwater contribution, at an annual timescale the next river downstream must also receive some amount of groundwater and thus is also non-ephemeral (endorheic outlets are already accounted for in our model). We also handle two other scenarios:

- We only count rivers/streams as ephemeral and recast all canals, ditches, and small ponds (waterbodies $< 0.01 km^2$) as non-ephemeral. These features fall under different WOTUS rules and are not the focus of this study.

- While Mexican and Canadian ephemeral streams contribute streamflow to the CONUS drainage network, our focus is on CONUS water quality. These streams are thus recast as non-ephemeral.

#### 3.2 Validation

Ephemeral classification accuracy is assessed using the field assessment dataset (Section 1.4). We assess performance using regional classification accuracy, sensitivity (the true positive rate), specificity (the true negative rate), and "informedness", which is also called the true skill statistic (*TSS*) or Youden's *J* depending on the literature [@alloucheAssessingAccuracySpecies2006]. See Table S`r table_nums("classVal", display="n")` for metric definitions. *TSS* is equal to the sensitivity + specificity - 1. It intuitively represents the performance improvement over a random classifier, i.e. a score of zero indicates that the model is equivalent to random guessing. Mathematically, *TSS* equals the distance (in units of sensitivity) between a point on the receiver operating characteristic (ROC) curve and a random classifier. *TSS* is more robust to class imbalances than simple percent accuracy and it has been used in the past to assess headwater and ephemeral mapping models [@fesenmyerLargePortionUSA2021; @russellSpatiallyExplicitModel2015; @cavalloExploitingSentinel2Dataset2022], so we use it here to compare against existing studies. Regional accuracy is mapped in Fig. S`r fig_nums_supp("mainVal", display="n")`, regional *TSS* is mapped in Fig. S`r fig_nums_supp("val2", display="n")`, regional sensitivity and specificity are mapped in Fig. S3, and boxplots of all metrics are Fig. S`r fig_nums_supp("val4", display="n")`. The validation results are discussed in Text S1.

#### 3.3 Choosing a validation snapping threshold
In general, classification performance should decrease as the snapping threshold (section 1.4) increases because field data will be assigned to the wrong rivers. So, we test the sensitivity of our model to this threshold to inform our choice.

First, we re-project all data using the Universal Transverse Mercator (UTM) projection system to ensure snapping distances are regionally accurate. Then, we test a range of snapping thresholds from 5m to 50m and assess ephemeral classification accuracy (Fig. S`r fig_nums_supp("classificationSens", display="n")`). We also confirm that the snapping threshold reproduces expected network scaling theory according to Horton's law of stream numbers [@hortonEROSIONALDEVELOPMENTSTREAMS1945]. Equation S4 is the Horton law of stream numbers, which is a power-law function relating stream order $SO_m$ to the number of streams in the $m^{th}$ order $N_m$ [@hortonEROSIONALDEVELOPMENTSTREAMS1945]. $R_B$ is the Horton ratio and $N_{max}$ is the number of streams in the largest order. $R_B$ is solved via least-squares regression. We fit equation S4 to all confirmed ephemeral streams (section 1.4) after snapping them to the NHD-HR using some threshold. This approach assumes the following:

- Ephemeral streams aggregated from many CONUS drainage networks will fit a single Horton scaling. Horton laws are a statistical inevitability of stream ordering and do not represent an inherent geomorphic process [@kirchnerStatisticalInevitabilityHorton1993; @miltonGeomorphicIrrelevanceDrainage1966; @bowdenEFFECTSTREAMORDERINGTECHNIQUE1964], but rather arise from hydrography resolution and channelization definitions. Because we use a CONUS-scale product with consistent stream ordering, this is reasonable.

- The ephemeral field data (section 1.4) is representative of the actual distribution of ephemeral streams across CONUS. Because these data consist of voluntary field assessments, it is likely an underestimate of ephemeral stream presence. Actual estimates are presumably even greater.

$$N_m=N_{max}*R_B^{SO_{max} - SO_m} \mathbf{(S4)}$$

After fitting equation S4, we assess how well it's predicted $N_m$ matches the actual field data snapped to the NHD-HR (section 1.4). Overall, we find that the ephemeral river network most closely matches expected network scaling with a snapping threshold of 5-15m (Fig. S`r fig_nums_supp("snappingSens", display="n")`). Otherwise, this scaling relationship begins to break down. Taking Figs. S`r fig_nums_supp("classificationSens", display="n")`-S`r fig_nums_supp("snappingSens", display="n")` in aggregate, we find a snapping threshold of 10m to be most appropriate for our purposes here. This threshold also conveniently allows a direct comparison against the only existing ephemeral classification model [@fesenmyerLargePortionUSA2021], built using 10m gridded flow accumulation data.

#### 3.4 Influence of hydrography resolution
Given that much of our ephemeral field data does not fall on the mapped drainage network and instead corresponds to streams too small to be explicitly represented in the NHD-HR, we also assess 1) the amount of ephemeral streams we are missing, and 2) whether this matters for our goals of quantifying ephemeral contributions to discharge. To do this, equation S4 can be re-expressed as equation S5, where *k* is the minimum stream order. Our field data (section 1.4) provides us with $N_k$ enabling the direct calculation of $SO_k$. This approach assumes that all streams in the scaled stream order(s) are ephemeral. Given that `r perc_riverSource_eph`% of source reach extent is ephemeral in our model, this is reasonable.

$$SO_k = \frac{log(N_k) - log(N_{max}) - SO_{max}log(R_B)}{-log(R_B)} \mathbf{(S5)}$$

Using equation S5, we find that one additional ephemeral stream order would need to be added to the NHD-HR to reproduce the field data distribution (Fig. S`r fig_nums_supp("scalingFig", display="n")`). The likely significant omission errors in our field data suggest that one additional stream order is a conservative estimate. Because of these results (and because streamflow and drainage area generally accumulate downstream), we can safely assume that out model's headwater ephemeral discharge contributions implicitly include the scaled ephemeral stream order as well, despite not being explicitly mapped in the NHD-HR.

### 4 Estimating ephemeral flow frequency
We estimate the basin-average flow frequency of ephemeral streams via the mean annual number of days per year that they flow ($N_{flw}$- equation S3). We do this using mean annual, basin-averaged runoff data measured at streamgauges [@brakebillDigitalHydrologicNetworks2011] and daily gridded precipitation for 1980-2006 [@xieGaugeBasedAnalysisDaily2007]. The model is purposefully simple but globally scalable (Fig. `r fig_nums("figNflw", display="n")`b).

#### 4.1 Data
We use field data only to determine an operational runoff threshold, as well to verify the model's performance. Note that field $N_{flw}$ data is relatively uncommon and measured using different sensor techniques (streamgauges, temporary flumes, and electrical resistance senors). To our knowledge, we use all existing field data [@zimmerBidirectionalStreamGroundwater2017; @fritzCoarseParticulateOrganic2019; @kampfRainfallThresholdsFlow2018; @slaughterThirtyfiveYearsResearch2001; @stoneLongtermRunoffDatabase2008; @schoenerImpactUrbanizationStormwater2022; @strombergRiparianVegetationEphemeral2017; @peirceCharacterizingEphemeralStreams2015] that provides sufficient information to calculate $N_{flw}$ (Table S`r table_nums("Nflw_data", display="n")` details the studies). To get all data in a uniform format, we calculate mean annual $N_{flw}$ at each sensor (if applicable), and then take the catchment average $N_{flw}$ across the sensed streams (again, if applicable). This averaging was not done in catchments with insufficient data and therefore significant uncertainties exist in many of these estimates.

Length of the timeseries varies significantly, from approximately 1/3 of a year [@peirceCharacterizingEphemeralStreams2015] to 45 years of sub-daily data in the Walnut Gulch Experimental Watershed [@stoneLongtermRunoffDatabase2008]. Data from @peirceCharacterizingEphemeralStreams2015 exist for three sites within a catchment in Ontario that do not flow into the United States. However, they are located approximately 15 km from one of our model basins that does flow into the U.S. (Fig. `r fig_nums("figNflw", display="n")`a) and so we use that basin for verification. Additionally, that data is only for 1/3 of the year (approximately July to October). To obtain a mean annual estimate, we assumed the frequency of flow was the same year round, i.e. we tripled the $N_{flw}$ measured in their study. Likewise, @fritzCoarseParticulateOrganic2019 only assessed their streams for the latter half of a year, though reports indicate that flow generally occurs only 1-2 times in the remaining months [@fritzStructuralFunctionalCharacteristics2010], so we added that to the calculation. Finally, one site [@zimmerBidirectionalStreamGroundwater2017] includes an intermittent main stem where the flow was measured, however the rest of the drainage system is ephemeral [@zimmerBidirectionalStreamGroundwater2017].

#### 4.2 Model

Streams are traditionally viewed as a surifical expression of groundwater [@winterGroundWaterSurface1999]. However, by definition ephemeral streams expand beyond the boundary of the surface extent of groundwater [@zimmerLateralVerticalLongitudinal2018]. Because they have no groundwater component, $N_{flw}$ is purely controlled by surface runoff and interflow. This assumption significantly simplifies our modeling and enables the calculation of $N_{flw}$ solely via surface runoff generation.

In that context, we first calculate a mean annual basin runoff ratio $i_r$ to convert precipitation *P* to stream runoff *i* and vice versa. The runoff ratio (equation S6) reflects the proportion of rainfall on the basin that winds up as stream runoff, where the implicit losses are via groundwater recharge and evapotranspiration. Using a mean annual $i_r$ also implicitly accounts for snowmelt runoff in winter.

$$i_r = \frac{i}{P} \mathbf{(S6)}$$

We convert daily precipitation depth to daily, basin-averaged stream runoff depth using $i_r$. Per equation S3, streamflow occurs when daily runoff exceeds some operational runoff threshold. We tally all days when flow occurs over the 27 years and calculate a mean annual $N_{flw}$, which is mapped in Fig. `r fig_nums("figNflw", display="n")`a. For a handful of basins on the Mexican/Canadian borders, there are no USGS gauges and no $i_r$ data. We use the mean annual runoff values from adjacent basins (the "closest" as assessed visually) and assume it holds constant in these basins. We perform a sensitivity test of the $i_r$ data, as it is biased towards gauged, often larger, rivers. For this test, we use equation S3 and run the model under the four scenarios detailed in Table S`r table_nums("runoff_tests", display="n")`. At the basin-scale, results change only slightly (Fig. S`r fig_nums_supp("nFlwSens", display="n")`).

We also parameterize watershed 'memory': a bulk parameter representing all delayed runoff to the drainage network. More practically, the memory parameter keeps streams 'turned on' for a number of days following a day identified as flowing. Memory parameter assignment was guided by a recent analysis [@mogesStrengthMemoryPrecipitation2022], which calculated the streamflow memory of rain events for 671 watersheds in CONUS, including many with groundwater influence. They found a median memory of approximately 4 days, which is used here.

The operational $i_{min}$ is determined using the $N_{flw}$ field data (section 4.1) as, to our knowledge, there is no consensus on what runoff depth defines a flowing stream. Thus, the operational definition of $i_{min}$ may change change with new additional field measurements of $N_{flw}$. We use the coefficient of determination $r^2$, the mean absolute error (*MAE*) and the root mean square error (*RMSE*) to determine the best performing $i_{min}$ of approximately 2.5 mm/day (Fig. `r fig_nums("figNflw", display="n")`b, Fig. S`r fig_nums_supp("runoffCalib", display="n")`).

#### 4.3 Verification

We verify the model against existing field measurements of ephemeral flow frequency (Text S1, Fig. `r fig_nums("figQ_SO", display="n")`b). We express uncertainty in the average estimate as 1 standard error (SE) of the regression between predicted and observed. We stress that, because of the limited and highly uncertain data on $N_{flw}$ and the necessary calibration of $i_{min}$, we refer to this as a model verification: all we can do is confirm that the model is reasonably realistic. We leave model refinement and constraining field-measured $N_{flw}$ to future work.

## Text S1: Model performance
### Discharge model performance
The discharge model accurately captures mean annual discharges for 1970-2018 across both perennial and non-perennial streams (Fig. S`r fig_nums_supp("mainVal", display="n")`). This performance is similar to another discharge model used to map global river intermittency [@messagerGlobalPrevalenceNonperennial2021].

### Classification performance
Ephemeral mapping performance varies across the United States. Regional average *TSS* is `r round(mean(val_shapefile_fin$basinTSS, na.rm=T),2)` (Fig. S`r fig_nums_supp("val2", display="n")`a), average regional accuracy is `r ceiling(mean(val_shapefile_fin$basinAccuracy)*100)`% (Fig. S`r fig_nums_supp("mainVal", display="n")`a), average regional sensitivity is `r ceiling(mean(val_shapefile_fin$basinSensitivity, na.rm=T)*100)`% (Fig. S`r fig_nums_supp("val3", display="n")`a) and average regional specificity was `r round(mean(val_shapefile_fin$basinSpecificity*100),0)`% (Fig. S`r fig_nums_supp("val3", display="n")`b). Performance is best in the northeastern U.S. and western U.S. (average *TSS* of `r round(mean(val_shapefile_fin[val_shapefile_fin$huc2 %in% goodAccuracy,]$basinTSS),2)`), while performance is worse in the Midwest and Great Plains (average *TSS* of `r round(mean(val_shapefile_fin[val_shapefile_fin$huc2 %in% badAccuracy,]$basinTSS),2)`). Overall, we outperform the only existing continental-scale ephemeral stream map [@fesenmyerLargePortionUSA2021], which reported a CONUS *TSS* of 0.45, sensitivity of 63%, and specificity of 83%.

### Field-scale performance in an experimental catchment
The Walnut Gulch experimental watershed in Arizona is home to one of the longest continuous ephemeral streamgauge records in the world and features a nested gauging scheme that enables whole-watershed studies for arid hydrology [@stoneLongtermRunoffDatabase2008]. The entire watershed drainage network is ephemeral. Here, we verify that our model 1) reproduces the completely-ephemeral drainage system (Fig. S`r fig_nums_supp("walnutGulch", display="n")`a) and 2) reproduces the mean annual ephemeral discharges throughout the drainage network (Fig. S`r fig_nums_supp("walnutGulch", display="n")`b).

### Equations S1 and S2 performance
At continental scales, it is impossible to validate equations S1 and S2 in a traditional sense. To broadly verify that our calculations make sense, we extend previous work by @alexanderRoleHeadwaterStreams2007, who used Tokunaga network scaling in the northeastern US to quantify relative headwater contributions to downstream discharge. Tokunaga ratios represent the average number of upstream ephemeral reaches that flow into the average reach per stream order [@zanardoAreAmericanRivers2013; @alexanderRoleHeadwaterStreams2007]. Assuming that discharge accumulates downstream, relative ephemeral Tokunaga ratios should be approximately similar to our routing calculations, i.e. if 50% of upstream rivers are ephemeral, than 50% of streamflow would be ephemerally sourced in a perfectly gaining watershed.

Here, we use Tokunaga ratios to calculate the average number of upstream ephemeral rivers per stream order, using network length rather than number of reaches due to the artificial paths necessary to incorporate lakes and reservoirs into the drainage network [@brinkerhoffLakeMorphometryRiver2021]. When compared against our equation S1 results (Fig S`r fig_nums_supp("mainVal", display="n")`c), this analysis confirms that our results are generally in line with those anticipated by network scaling theory.

## Supplementary Figures
![`r fig_nums_supp("mainVal", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/validationPlot.jpg)

![`r fig_nums_supp("val2", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/validationMap.jpg)

![`r fig_nums_supp("val3", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/validationMap2.jpg)

![`r fig_nums_supp("val4", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/boxPlots_classification.jpg)

![`r fig_nums_supp("walnutGulch", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/walnutGulch.jpg)

![`r fig_nums_supp("classificationSens", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/acc_sens_to_snapping.jpg)

![`r fig_nums_supp("snappingSens", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/snappingThreshTradeOff.jpg)

![`r fig_nums_supp("scalingFig", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/scalingModel.jpg)

![`r fig_nums_supp("nFlwSens", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/boxPlots_sensitivity.jpg)

![`r fig_nums_supp("runoffCalib", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/runoffThresh_fitting.jpg)

![`r fig_nums_supp("hydrographies", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/hydrographyMaps.jpg)

![`r fig_nums_supp("drainageAreaMap", display="full")`](/nas/cee-water/cjgleason/craig/CONUS_ephemeral/cache/drainageAreaMap.jpg)

## Supplementary Tables

**Table S`r table_nums("data_summary", display="n")`:** `r substr(table_nums("data_summary", display="full"), 11, nchar(table_nums("data_summary", display="full")))`

|Variable           | Dataset Name                                      | Spatial Resolution        | Temporal Resolution | Years captured          | Reference                                                              |
|-------------------|---------------------------------------------------|---------------------------|---------------------|-------------------------|------------------------------------------------------------------------|
| Hydrography       | USGS National Hydrography dataset (NHD)           | 1:24,000                  | -                   | Long-term               | @u.s.geologicalsurveyNationalHydrographyDataset2022                    |
| Discharge         | USGS discharge model                              | 1:24,000                  | Year                | 1970-2000               | @u.s.geologicalsurveyNationalHydrographyDataset2022                    |
| Water Table Depth | Fan Global Soil Hydrology Model                   | 30"                       | Month               | 2004-2014               | @fanHydrologicRegulationPlant2017; @fanGlobalPatternsGroundwater2013   |
| Precipitation     | CPC Unified Gauge-based Daily Precipitation Model | 0.25'                     | Day                 | 1980-2006               | @xieGaugeBasedAnalysisDaily2007; @chenAssessingObjectiveTechniques2008 |
| Runoff            | USGS runoff data                                  | USGS level 4 basins       | Year                | varies (from 1901-2021) | @brakebillDigitalHydrologicNetworks2011                                |

**Table S`r table_nums("field_data", display="n")`:** `r substr(table_nums("field_data", display="full"), 11, nchar(table_nums("field_data", display="full")))`

```{r, echo=FALSE, message=FALSE}
df <- readr::read_csv('/nas/cee-water/cjgleason/craig/CONUS_ephemeral_data/for_ephemeral_project/new_england_fieldSites.csv')
df <- dplyr::select(df, c('name', 'lat', 'lon', 'score', 'classification'))

knitr::kable(df[, 1:5], format = "pipe", col.names = c('Name', 'Latitude', 'Longitude', 'Score', 'Classification'))

```

**Table S`r table_nums("classVal", display="n")`:** `r substr(table_nums("classVal", display="full"), 11, nchar(table_nums("classVal", display="full")))`

| Name                   | Definition                                          |
|------------------------|-----------------------------------------------------|
| Accuracy               | $\frac{N_{TP}+N_{TN}}{N_{TP}+N_{TN}+N_{FP}+N_{FN}}$ |
| Sensitivity            | $\frac{N_{TP}}{N_{TP}+N_{FN}}$                      |
| Specificity            | $\frac{N_{TN}}{N_{TN}+N_{FP}}$                      |
| True Skill Score (TSS) | Sensitivity + Specificity - 1                       |

**Table S`r table_nums("Nflw_data", display="n")`:** `r substr(table_nums("Nflw_data", display="full"), 11, nchar(table_nums("Nflw_data", display="full")))`

```{r, echo=FALSE}
df <- flowingDaysValidation
df$num_flowing_dys <- round(df$num_flowing_dys, 0)
df$n_flw_d <- round(df$n_flw_d, 0)
df$drainage_area_km2 <- round(df$drainage_area_km2, 0)
df <- df[,c(2,3,5,6,7,8,9)]
knitr::kable(df, format = "pipe", col.names = c('Model Basin', 'Model Nflw [dys]', 'Observed Nflw [dys]', 'Number Sample Years', 'Drainage Area [km2]', 'Number Sites','Reference'), row.names = FALSE)
```

**Table S`r table_nums("runoff_tests", display="n")`:** `r substr(table_nums("runoff_tests", display="full"), 11, nchar(table_nums("runoff_tests", display="full")))`

| Name          | Runoff ratio ($i_r$) |
|---------------|----------------------|
| Low runoff 1  | $i_r + 0.33i_r$      |
| Low runoff 2  | $i_r + 0.18i_r$      |
| High runoff 1 | $i_r - 0.33i_r$      |
| High runoff 2 | $i_r + 0.18i_r$      |

## References
